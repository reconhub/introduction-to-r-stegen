<!DOCTYPE html>
<html lang="en-us" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>An outbreak of gastroenteritis in Stegen, Germany, June 1998 &middot; </title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://reconlearn.org/favicon.ico" />
    <link rel="canonical" href="https://reconlearn.org/post/stegen.html" />

     <meta name="description" content="Context On 26 June 1998, the St Sebastian High School in Stegen (school A), Germany, celebrated a graduation party, where 250 to 350 participants were expected." /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://reconlearn.org/img/highres/graduation-1965.jpg"/>
    
 
    <meta name="twitter:title" content="An outbreak of gastroenteritis in Stegen, Germany, June 1998"/>
    <meta name="twitter:description" content="Context On 26 June 1998, the St Sebastian High School in Stegen (school A), Germany, celebrated a graduation party, where 250 to 350 participants were expected."/>
    <meta name="twitter:url" content="https://reconlearn.org/post/stegen.html" />
    <meta name="twitter:site" content="@teebzr"/>

    <meta property="og:site_name" content="" />
    <meta property="og:title" content="An outbreak of gastroenteritis in Stegen, Germany, June 1998 &middot; RECON learn" />
    <meta property="og:url" content="https://reconlearn.org/post/stegen.html" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="Context On 26 June 1998, the St Sebastian High School in Stegen (school A), Germany, celebrated a graduation party, where 250 to 350 participants were expected." />

    <meta property="article:published_time" content="2018-11-12T00:00:00Z" />
    <meta property="article:tag" content="level: beginner" /><meta property="article:tag" content="epicurve" /><meta property="article:tag" content="single variable analysis" /><meta property="article:tag" content="2x2 tables" /><meta property="article:tag" content="gastroenteritis" /><meta property="article:tag" content="plotting cases" />

    <meta property="og:image" content="https://reconlearn.org/img/highres/graduation-1965.jpg"/>


    <meta name="generator" content="Hugo 0.43" />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-oi8o31xSQq8S0RpBcb4FaLB8LJi9AT8oIdmS1QldR8Ui7KUQjNAnDlJjp55Ba8FG" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="https://reconlearn.org/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="https://reconlearn.org/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
     <link rel="stylesheet" href="https://reconlearn.org/css/custom.css" /> 

     

    

    <script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">
        <a class="site-nav-logo" href="/"><img src="https://reconlearn.org/img/logo/learnBlueAndWhite.png" alt="RECON learn" /></a>

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/"> Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/categories/lectures.html"><i class='far fa-align-justify'></i> Lectures</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/categories/practicals.html"><i class='far fa-align-justify'></i> Practicals</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/categories/case-studies.html"><i class='far fa-align-justify'></i> Case Studies</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/authors.html"><i class='far fa-align-justify'></i> Authors</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/topics.html"><i class='far fa-align-justify'></i> Topics</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/licenses.html"><i class='far fa-align-justify'></i> Licenses</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/about.html"> About</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/contact.html"> Contact</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/teebzr" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/reconhub/learn" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    
        </div>  
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post"> 
        <header class="post-full-header">
            <h1 class="post-full-title">An outbreak of gastroenteritis in Stegen, Germany, June 1998</h1>
            <section class="post-full-meta">
                <time class="post-full-meta-date" datetime="2018-11-12">12 November 2018</time>
                <span class="date-divider">/</span>
                
    <a href="/categories/case-studies.html">case studies</a> &nbsp;
  
            
                
            </section>
        </header>
        
         
        <section class="post-full-content">
                <div class="kg-card-markdown">
                

<h1 id="context">Context</h1>

<p>On 26 June 1998, the St Sebastian High School in Stegen (school A),
Germany, celebrated a graduation party, where 250 to 350 participants
were expected. Attendants included graduates from that school, their
families and friends, teachers, 12th grade students, and some graduates
from a nearby school (school B).</p>

<p>A self-service party buffet was supplied by a commercial caterer from a
the nearby city of Freiburg. Food was prepared on the day of the party
and transported in a refrigerated van to the school. Relative locations
of the two schools and Freiburg can be seen
below:</p>

<!--html_preserve-->

<iframe src="https://www.google.com/maps/d/u/0/embed?mid=1xYZh1AyB3h_mG4QihrO9LhFT3g5tjOv_" width="100%" height="500">

</iframe>

<!--html_preserve-->

<p>Festivities at school A started with a dinner buffet open from 8.30 pm
onwards and were followed by a dessert buffet offered from 10 pm. The
party and the buffet extended late into the night and alcoholic
beverages were quite popular. All agreed it was a party to be
remembered.</p>

<h2 id="the-alert">The alert</h2>

<p>On 2nd July 1998, the Freiburg local health office reported to the
Robert Koch Institute (RKI) in Berlin a significant increase of cases of
gastroenteritis in the munipality of Stegen following the graduation
party described above. More than 100 cases were suspected among
participants and some of them were so ill that they were admitted to
nearby hospitals. Sick people showed symptoms like; <em>fever, nausea,
diarrhoea and vomiting</em> lasting for several days. Stool samples were
collected from several ill cases and send to the laboratory in Freiburg
for microbiological identification. <em>Salmonella enteritidis</em> was
identified in 19 stool samples.</p>

<p>In response to the large number of cases associated with the dinner the
Freiburg health office sent an outbreak control team to investigate the
kitchen of the caterer in Freiburg. Food preparation procedures were
reviewed. Samples were taken of remaining food items after the
graduation ceremony and were sent to the laboratory of Freiburg
University. Microbiological analyses were performed on samples of the
following food items: brown chocolate mousse, caramel cream, remoulade
sauce, yoghurt dill sauce, and 10 raw eggs. Unfortunately no tiramisu
was left over after the dinner so no samples were tested of this
specific food item.</p>

<p>The Freiburg health office requested help from the RKI in the
investigation to assess the magnitude of the outbreak and identify
potential vehicle(s) and risk factors for transmission in order to
better control the outbreak.</p>

<h2 id="the-epidemiological-study">The epidemiological study</h2>

<p><strong>Case definition</strong>: cases were defined as any person who had attended
the party at St Sebastian High School and who suffered from <em>diarrhoea</em>
(min. 3 loose stool for 24 hours) between 27 June and 29 June 1998, or
from at least three of the following symptoms: <em>vomiting</em>, <em>fever over
38.5° C</em>, <em>nausea</em>, <em>abdominal pain</em>, <em>headache</em>.</p>

<p>Students from both schools attending the party were asked through phone
interviews to provide names of persons who attended the party.</p>

<p>Overall, 291 responded to enquiries and 103 cases were identified. The
linelist analysed in this case study was built from these 291 responses.</p>

<h2 id="this-case-study">This case study</h2>

<p>In this case study, we will take you through the analysis of this
epidemic using R. This will be the occasion to illustrate more generally
useful practices for data analysis using <strong>R</strong>, including:</p>

<ul>
<li>how to read and import data from Excel</li>
<li>how to explore data using tables and summaries</li>
<li>how to clean data</li>
<li>how to make graphics to describe the data</li>
<li>how to test if specific food items are linked to the disease</li>
<li>how to plot a very basic spatial overview of cases</li>
</ul>

<h1 id="initial-data-processing">Initial data processing</h1>

<h2 id="project-setup">Project setup</h2>

<p>When using R, it’s a very good idea to keep your data and scripts
organised together. One way of doing this is to keep them in a single
folder that hosts and RStudio project file. For this project, your
folder structure will start out looking like this:</p>

<pre><code>.
├── 01-stegen-analysis.R
├── data/
│   ├── stegen-map/
│   │   ├── stegen_households.cpg
│   │   ├── stegen_households.prj
│   │   ├── stegen_households.qpj
│   │   ├── stegen_households.shp
│   │   └── stegen_households.shx
│   └── stegen_raw.xlsx
├── LICENSE
├── README.md
└── stegen.Rproj
</code></pre>

<p>To create this, do the following steps:</p>

<ol>
<li>Open RStudio and <a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">create a new RStudio project in a new directory
called
“stegen”</a></li>
<li>Once you have your Project set up, make a new folder called “data/”
and <a href="../../data/stegen_raw.xlsx">download <code>stegen_raw.xlsx</code> and save it to that
folder</a></li>
<li><a href="../../data/stegen-map.zip">Download <code>stegen-map.zip</code></a> and extract
it to the “data/” folder</li>
<li>In RStudio, click on the following menu path: <kbd>File &gt; New File
&gt; R Script</kbd> and save it as <code>01-stegen-analysis.R</code>. This will
be the R script where you will save the code of the analysis.</li>
</ol>

<p><details></p>

<p><summary><b>Going Further:</b> What are the <code>LICENSE</code> and <code>README.md</code>
files?</summary></p>

<p>Both of these files are plain text files (edited via programs such as
notepad or textedit) that tell people how they can use the data and
code.</p>

<p>The <code>README.md</code> file is a text file that describes in plain language
what this project is about and what the components are. It’s called
README with the idea that anyone who comes across this project should be
able to read this file first and understand how to work with the
project.</p>

<p>The <code>LICENSE</code> file describes how the data and code are to be used. For
example, this case study is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
Attribution 4.0 International
license</a> which gives
people the freedom to reuse this in any way as long as they attribute
the original authors.</p>

<p></details></p>

<h2 id="loading-required-packages">Loading required packages</h2>

<p>The following packages will be used in the case study:</p>

<ul>
<li><a href="https://github.com/jennybc/here_here"><em>here</em></a>: to find the path to
data or script files</li>
<li><a href="https://readxl.tidyverse.org/"><em>readxl</em></a>: to read Excel
spreadsheets into R</li>
<li><a href="https://readr.tidyverse.org/"><em>readr</em></a>: to write (and read)
spreadsheets as text files</li>
<li><a href="https://www.repidemicsconsortium.org/incidence/"><em>incidence</em></a>: to
build epicurves</li>
<li><a href="https://www.repidemicsconsortium.org/epitrix/"><em>epitrix</em></a>: to clean
labels from our spreadsheet</li>
<li><a href="https://dplyr.tidyverse.org/"><em>dplyr</em></a>: to help with factors</li>
<li><a href="https://ggplot2.tidyverse.org/"><em>ggplot2</em></a>: to create custom
visualisations</li>
<li><a href="https://cran.r-project.org/web/packages/epitools/index.html"><em>epitools</em></a>:
to calculate risk ratios</li>
<li><a href="https://github.com/r-spatial/sf/"><em>sf</em></a>: To read in shape files</li>
<li><a href="https://rstudio.github.io/leaflet/"><em>leaflet</em></a>: to demonstrate
interactive maps</li>
</ul>

<p>If we have these packages installed, we can tell R to load these
packages from our R library:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;here&#34;</span>)      <span style="color:#75715e"># find data/script files</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;readxl&#34;</span>)    <span style="color:#75715e"># read xlsx files</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;readr&#34;</span>)     <span style="color:#75715e"># read and write text spreadsheets</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;incidence&#34;</span>) <span style="color:#75715e"># make epicurves</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;epitrix&#34;</span>)   <span style="color:#75715e"># clean labels and variables</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;dplyr&#34;</span>)     <span style="color:#75715e"># general data handling</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;ggplot2&#34;</span>)   <span style="color:#75715e"># advanced graphics</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;epitools&#34;</span>)  <span style="color:#75715e"># statistics for epi data</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;sf&#34;</span>)        <span style="color:#75715e"># shapefile handling</span>
<span style="color:#f92672">library</span>(<span style="color:#e6db74">&#34;leaflet&#34;</span>)   <span style="color:#75715e"># interactive maps</span></code></pre></div>
<p><details></p>

<p><summary> <b> Package not installed? Did you get an error? </b>
</summary></p>

<p>Note that you will get an error if the packages have not been installed
on your system. To install them (you only need to do this once!), type:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">install.packages(<span style="color:#e6db74">&#34;here&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;readxl&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;readr&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;incidence&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;epitrix&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;dplyr&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;ggplot2&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;epitools&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;sf&#34;</span>)
install.packages(<span style="color:#e6db74">&#34;leaflet&#34;</span>)</code></pre></div>
<p></details></p>

<p>Loading these packages makes all functions implemented by the packages
available, so that <code>function_name()</code> can be used directly (without the
<code>package_name::</code> prefix). This is not a problem here as these packages
do not implement functions with identical names.</p>

<h2 id="importing-data-from-excel">Importing data from Excel</h2>

<p>Linelist data can be read from various formats, including flat text
files (e.g. <code>.txt</code>, <code>.csv</code>), other statistical software (e.g. STATA) or
Excel spreadsheets. We illustrate the latter, which is probably the most
common format. We assume that <a href="../../data/stegen_raw.xlsx">the data file
<code>stegen_raw.xlsx</code></a> has been saved in a
<code>data/</code> folder of your project, and that your current R session is at
the root of the project.</p>

<p>Here we decompose the steps to read data in:</p>

<ol>
<li>finding the path to the data (<code>path_to_data</code>) with the <em>here</em>
package</li>
<li>using the function <code>read_excel()</code> from the <em>readxl</em> package to read
data in, and saving the output in a new object <code>stegen</code>.</li>
</ol>

<!-- end list -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">path_to_data <span style="color:#f92672">&lt;-</span> here(<span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;stegen_raw.xlsx&#34;</span>)
path_to_data
<span style="color:#75715e">## [1] &#34;/home/zkamvar/Documents/Websites/recon-learn/data/stegen_raw.xlsx&#34;</span></code></pre></div>
<blockquote>
<p>n.b. the value of <code>path_to_data</code> will not be the what you see in this
tutorial. It will be the location of this data set on your
computer.</p>
</blockquote>

<!-- !Should we add an e.g. here, change 'path to data' to .../../stegencasestudy/data/.. ? 
-->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen <span style="color:#f92672">&lt;-</span> read_excel(path_to_data)</code></pre></div>
<p>To look at the content of the dataset, we can use either of these
commands:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen
<span style="color:#75715e">## # A tibble: 291 x 23</span>
<span style="color:#75715e">##    `Unique key`   ill `Date-onset`   SEX   Age tiramisu tportion wmousse</span>
<span style="color:#75715e">##           &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;</span>
<span style="color:#75715e">##  1          210     1 1998-06-27       1    18        1        3       0</span>
<span style="color:#75715e">##  2           12     1 1998-06-27       0    57        1        1       0</span>
<span style="color:#75715e">##  3          288     1 1998-06-27       1    56        0        0       0</span>
<span style="color:#75715e">##  4          186     1 1998-06-27       0    17        1        1       1</span>
<span style="color:#75715e">##  5           20     1 1998-06-27       1    19        1        2       0</span>
<span style="color:#75715e">##  6          148     1 1998-06-27       0    16        1        2       1</span>
<span style="color:#75715e">##  7          201     1 1998-06-27       0    19        1        3       0</span>
<span style="color:#75715e">##  8          106     1 1998-06-27       0    19        1        2       1</span>
<span style="color:#75715e">##  9          272     1 1998-06-27       1    40        1        2       1</span>
<span style="color:#75715e">## 10           50     1 1998-06-27       0    53        1        1       1</span>
<span style="color:#75715e">## # ... with 281 more rows, and 15 more variables: dmousse &lt;dbl&gt;,</span>
<span style="color:#75715e">## #   mousse &lt;dbl&gt;, mportion &lt;dbl&gt;, Beer &lt;dbl&gt;, redjelly &lt;dbl&gt;, `Fruit</span>
<span style="color:#75715e">## #   salad` &lt;dbl&gt;, tomato &lt;dbl&gt;, mince &lt;dbl&gt;, salmon &lt;dbl&gt;,</span>
<span style="color:#75715e">## #   horseradish &lt;dbl&gt;, chickenwin &lt;dbl&gt;, roastbeef &lt;dbl&gt;, PORK &lt;dbl&gt;,</span>
<span style="color:#75715e">## #   latitude &lt;dbl&gt;, longitude &lt;dbl&gt;</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">View(stegen)</code></pre></div>
<p><details></p>

<p><summary><b>Problems?</b> In case of trouble, click here to toggle
additional help:</summary></p>

<p>If the above fails, you should check:</p>

<ul>
<li>that your data file has been saved in the right folder, with the
right name (lower case and upper case do matter)</li>
<li>that your R session was started from the right project - if unsure,
close R and re-open Rstudio by double-clicking on the <code>.Rproj</code> file</li>
<li>that all packages are installed and loaded (see installation
guidelines above)</li>
</ul>

<p></details></p>

<h2 id="overview-and-summaries">Overview and summaries</h2>

<p>We first have a quick look at the content of the data set. The
information we are looking for is:</p>

<ul>
<li>the numbers of cases (rows) and variables (columns) in the data</li>
<li>the <em>name</em> of the variables: do they use consistent capitalisation
and separators?</li>
<li>the <em>type</em> of the variables: are dates, numeric or categorical
variables used when they should?</li>
<li>the <em>coding</em> of the variables: are explicit labels (e.g.
<code>&quot;male&quot;</code>/<code>&quot;female&quot;</code>) used where relevant?</li>
</ul>

<p>We first check the dimensions of the <code>stegen</code> object, and the name of
the variables:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">dim</span>(stegen) <span style="color:#75715e"># rows x columns</span>
<span style="color:#75715e">## [1] 291  23</span>
<span style="color:#66d9ef">names</span>(stegen) <span style="color:#75715e"># column labels</span>
<span style="color:#75715e">##  [1] &#34;Unique key&#34;  &#34;ill&#34;         &#34;Date-onset&#34;  &#34;SEX&#34;         &#34;Age&#34;        </span>
<span style="color:#75715e">##  [6] &#34;tiramisu&#34;    &#34;tportion&#34;    &#34;wmousse&#34;     &#34;dmousse&#34;     &#34;mousse&#34;     </span>
<span style="color:#75715e">## [11] &#34;mportion&#34;    &#34;Beer&#34;        &#34;redjelly&#34;    &#34;Fruit salad&#34; &#34;tomato&#34;     </span>
<span style="color:#75715e">## [16] &#34;mince&#34;       &#34;salmon&#34;      &#34;horseradish&#34; &#34;chickenwin&#34;  &#34;roastbeef&#34;  </span>
<span style="color:#75715e">## [21] &#34;PORK&#34;        &#34;latitude&#34;    &#34;longitude&#34;</span></code></pre></div>
<p>We can now try and summarise the dataset using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">summary</span>(stegen)
<span style="color:#75715e">##    Unique key         ill         Date-onset             SEX        </span>
<span style="color:#75715e">##  Min.   :  1.0   Min.   :0.000   Length:291         Min.   :0.0000  </span>
<span style="color:#75715e">##  1st Qu.: 73.5   1st Qu.:0.000   Class :character   1st Qu.:0.0000  </span>
<span style="color:#75715e">##  Median :146.0   Median :0.000   Mode  :character   Median :1.0000  </span>
<span style="color:#75715e">##  Mean   :146.0   Mean   :0.354                      Mean   :0.5223  </span>
<span style="color:#75715e">##  3rd Qu.:218.5   3rd Qu.:1.000                      3rd Qu.:1.0000  </span>
<span style="color:#75715e">##  Max.   :291.0   Max.   :1.000                      Max.   :1.0000  </span>
<span style="color:#75715e">##                                                                     </span>
<span style="color:#75715e">##       Age           tiramisu         tportion         wmousse      </span>
<span style="color:#75715e">##  Min.   :12.00   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  </span>
<span style="color:#75715e">##  1st Qu.:18.00   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000  </span>
<span style="color:#75715e">##  Median :20.00   Median :0.0000   Median :0.0000   Median :0.0000  </span>
<span style="color:#75715e">##  Mean   :26.66   Mean   :0.4231   Mean   :0.6678   Mean   :0.2599  </span>
<span style="color:#75715e">##  3rd Qu.:27.00   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:1.0000  </span>
<span style="color:#75715e">##  Max.   :80.00   Max.   :1.0000   Max.   :3.0000   Max.   :1.0000  </span>
<span style="color:#75715e">##  NA&#39;s   :8       NA&#39;s   :5        NA&#39;s   :5        NA&#39;s   :14      </span>
<span style="color:#75715e">##     dmousse           mousse          mportion           Beer       </span>
<span style="color:#75715e">##  Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  </span>
<span style="color:#75715e">##  1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000  </span>
<span style="color:#75715e">##  Median :0.0000   Median :0.0000   Median :0.0000   Median :0.0000  </span>
<span style="color:#75715e">##  Mean   :0.3937   Mean   :0.4256   Mean   :0.6523   Mean   :0.3911  </span>
<span style="color:#75715e">##  3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:1.0000  </span>
<span style="color:#75715e">##  Max.   :1.0000   Max.   :1.0000   Max.   :3.0000   Max.   :1.0000  </span>
<span style="color:#75715e">##  NA&#39;s   :4        NA&#39;s   :2        NA&#39;s   :12       NA&#39;s   :20      </span>
<span style="color:#75715e">##     redjelly       Fruit salad        tomato           mince      </span>
<span style="color:#75715e">##  Min.   :0.0000   Min.   :0.000   Min.   :0.0000   Min.   :0.000  </span>
<span style="color:#75715e">##  1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:0.0000   1st Qu.:0.000  </span>
<span style="color:#75715e">##  Median :0.0000   Median :0.000   Median :0.0000   Median :0.000  </span>
<span style="color:#75715e">##  Mean   :0.2715   Mean   :0.244   Mean   :0.2852   Mean   :0.299  </span>
<span style="color:#75715e">##  3rd Qu.:1.0000   3rd Qu.:0.000   3rd Qu.:1.0000   3rd Qu.:1.000  </span>
<span style="color:#75715e">##  Max.   :1.0000   Max.   :1.000   Max.   :1.0000   Max.   :1.000  </span>
<span style="color:#75715e">##                                                                   </span>
<span style="color:#75715e">##      salmon        horseradish       chickenwin       roastbeef      </span>
<span style="color:#75715e">##  Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :0.00000  </span>
<span style="color:#75715e">##  1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.00000  </span>
<span style="color:#75715e">##  Median :0.0000   Median :0.0000   Median :0.0000   Median :0.00000  </span>
<span style="color:#75715e">##  Mean   :0.4811   Mean   :0.3093   Mean   :0.2887   Mean   :0.09966  </span>
<span style="color:#75715e">##  3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:0.00000  </span>
<span style="color:#75715e">##  Max.   :9.0000   Max.   :9.0000   Max.   :1.0000   Max.   :1.00000  </span>
<span style="color:#75715e">##                                                                      </span>
<span style="color:#75715e">##       PORK           latitude       longitude    </span>
<span style="color:#75715e">##  Min.   :0.0000   Min.   :47.98   Min.   :7.952  </span>
<span style="color:#75715e">##  1st Qu.:0.0000   1st Qu.:47.98   1st Qu.:7.959  </span>
<span style="color:#75715e">##  Median :0.0000   Median :47.98   Median :7.961  </span>
<span style="color:#75715e">##  Mean   :0.4742   Mean   :47.98   Mean   :7.962  </span>
<span style="color:#75715e">##  3rd Qu.:1.0000   3rd Qu.:47.98   3rd Qu.:7.965  </span>
<span style="color:#75715e">##  Max.   :9.0000   Max.   :47.99   Max.   :7.974  </span>
<span style="color:#75715e">##                   NA&#39;s   :160     NA&#39;s   :160</span></code></pre></div>
<p>Note that binary variables, when treated as numeric values (0/1), are
summarised as such, which may not always be useful. As an alternative,
<code>table()</code> can be used to list all possible values of a variable, and
count how many time each value appears in the data. For instance, we can
compare the <code>summary()</code> and <code>table()</code> for consumption of <code>tiramisu</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen<span style="color:#f92672">$</span>tiramisu <span style="color:#75715e"># all values</span>
<span style="color:#75715e">##   [1]  1  1  0  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1</span>
<span style="color:#75715e">##  [24]  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1</span>
<span style="color:#75715e">##  [47]  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  0  1  1  1 NA  1</span>
<span style="color:#75715e">##  [70]  0  1  1 NA  1  1  1  1  1  1  1  1  1  1  1  0  1  1  0  1  1  1  1</span>
<span style="color:#75715e">##  [93]  1  0  1  1  1  1  0  0  0  0  0  0  0  0  1  0  1  0  0  1  0  0  0</span>
<span style="color:#75715e">## [116]  0  0  0 NA  1  0  0  1  0  0  0  0  0  1  0  0  0  0  1  0  0  0  0</span>
<span style="color:#75715e">## [139]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  0  0  0  0  1</span>
<span style="color:#75715e">## [162]  0  0  1  0  0  0  0  0  0  0  0  0  0  1  1  0  0  0  0  0  0  0  0</span>
<span style="color:#75715e">## [185]  0  0  0 NA  0  0  0  0  0  1  0  0  1  0  1  1  0  0  0  0  1  0  0</span>
<span style="color:#75715e">## [208]  0  0  0  0  0  1  0  0  1  0  0  0  0  1  0  0  1  0  0  0  1  1  0</span>
<span style="color:#75715e">## [231]  0  0  0  0  0  1  0  0  0  0  0  0  0  1  0  1  0  0  0  0  0  0  0</span>
<span style="color:#75715e">## [254]  0  0  1  0  0  0  1  0  0  0  1  0  0  0  0  0  0 NA  0  1  0  0  0</span>
<span style="color:#75715e">## [277]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1</span>
<span style="color:#66d9ef">summary</span>(stegen<span style="color:#f92672">$</span>tiramisu) <span style="color:#75715e"># summary</span>
<span style="color:#75715e">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span>
<span style="color:#75715e">##  0.0000  0.0000  0.0000  0.4231  1.0000  1.0000       5</span>
<span style="color:#66d9ef">table</span>(stegen<span style="color:#f92672">$</span>tiramisu) <span style="color:#75715e"># table</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">##   0   1 </span>
<span style="color:#75715e">## 165 121</span></code></pre></div>
<p><strong>Good news</strong>: the dataset has the expected dimensions, and all the
relevant variables seem to be present. There are, however, <strong>a few often
observed issues</strong>:</p>

<ol>
<li>variable names are a bit messy, and include different separators,
spaces, and irregular capitalisation</li>
<li>variable types are partly wrong:

<ul>
<li><em>unique keys</em> should be <code>character</code> (i.e. character strings)</li>
<li><em>dates of onset</em> should be <code>Date</code> (<strong>R</strong> is good at handling
actual dates)</li>
<li><em>illness</em> and <em>sex</em> should be <code>factor</code> (i.e. a categorical
variables)</li>
</ul></li>
<li>labels used in some variables are ambiguous:

<ul>
<li><em>sex</em> should be coded explicitely, not as 0 (here, male) and 1
(here, female)</li>
<li><em>illness</em> should be coded explicitely, not as 0 (here, non-case)
and 1 (case)</li>
</ul></li>
<li>some binary variables have maximum values of 9 (see
<code>summary(stegen)</code>)</li>
</ol>

<h2 id="data-cleaning">Data cleaning</h2>

<p>While it is tempting to go back to the Excel spreadsheet to fix issues
with data, it is almost always quicker and more reliable to clean data
in <strong>R</strong> directly. Here, we make a copy of the old data set, and clean
<code>stegen</code> before further analysis.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen_old <span style="color:#f92672">&lt;-</span> stegen <span style="color:#75715e"># save &#39;dirty data&#39;</span></code></pre></div>
<p>We use *epitrix*’s function <code>clean_labels()</code> to standardise the variable
names:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">new_labels <span style="color:#f92672">&lt;-</span> clean_labels(<span style="color:#66d9ef">names</span>(stegen)) <span style="color:#75715e"># generate standardised labels</span>
new_labels <span style="color:#75715e"># check the result</span>
<span style="color:#75715e">##  [1] &#34;unique_key&#34;  &#34;ill&#34;         &#34;date_onset&#34;  &#34;sex&#34;         &#34;age&#34;        </span>
<span style="color:#75715e">##  [6] &#34;tiramisu&#34;    &#34;tportion&#34;    &#34;wmousse&#34;     &#34;dmousse&#34;     &#34;mousse&#34;     </span>
<span style="color:#75715e">## [11] &#34;mportion&#34;    &#34;beer&#34;        &#34;redjelly&#34;    &#34;fruit_salad&#34; &#34;tomato&#34;     </span>
<span style="color:#75715e">## [16] &#34;mince&#34;       &#34;salmon&#34;      &#34;horseradish&#34; &#34;chickenwin&#34;  &#34;roastbeef&#34;  </span>
<span style="color:#75715e">## [21] &#34;pork&#34;        &#34;latitude&#34;    &#34;longitude&#34;</span>
<span style="color:#66d9ef">names</span>(stegen) <span style="color:#f92672">&lt;-</span> new_labels</code></pre></div>
<p>We convert the unique identifiers to character strings (<code>character</code>),
dates of onset to actual <code>Date</code> objects, and sex and illness are set to
categorical variables (<code>factor</code>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen<span style="color:#f92672">$</span>unique_key <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">as.character</span>(stegen<span style="color:#f92672">$</span>unique_key)
stegen<span style="color:#f92672">$</span>sex <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">factor</span>(stegen<span style="color:#f92672">$</span>sex)
stegen<span style="color:#f92672">$</span>ill <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">factor</span>(stegen<span style="color:#f92672">$</span>ill)
stegen<span style="color:#f92672">$</span>date_onset <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">as.Date</span>(stegen<span style="color:#f92672">$</span>date_onset)</code></pre></div>
<p>We use the function <code>recode()</code> from the <em>dplyr</em> package to recode <code>sex</code>
more explicitely:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen<span style="color:#f92672">$</span>sex <span style="color:#f92672">&lt;-</span> recode_factor(stegen<span style="color:#f92672">$</span>sex, <span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;male&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;female&#34;</span>)
stegen<span style="color:#f92672">$</span>ill <span style="color:#f92672">&lt;-</span> recode_factor(stegen<span style="color:#f92672">$</span>ill, <span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;non case&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;case&#34;</span>)</code></pre></div>
<p>Finally we look in more depth into these variables having maximum values
of 9, where we expect 0/1; <code>table()</code> is useful to list all values taken
by a variable, and listing their frequencies:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">table</span>(stegen<span style="color:#f92672">$</span>pork)
<span style="color:#75715e">## </span>
<span style="color:#75715e">##   0   1   9 </span>
<span style="color:#75715e">## 169 120   2</span>
<span style="color:#66d9ef">table</span>(stegen<span style="color:#f92672">$</span>salmon)
<span style="color:#75715e">## </span>
<span style="color:#75715e">##   0   1   9 </span>
<span style="color:#75715e">## 183 104   4</span>
<span style="color:#66d9ef">table</span>(stegen<span style="color:#f92672">$</span>horseradish)
<span style="color:#75715e">## </span>
<span style="color:#75715e">##   0   1   9 </span>
<span style="color:#75715e">## 217  72   2</span></code></pre></div>
<p>The only rogue values are <code>9</code>; they are likely either data entry issues,
or missing data, which in <strong>R</strong> should be coded as <code>NA</code> (“not
available”). We can replace these values using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen<span style="color:#f92672">$</span>pork[stegen<span style="color:#f92672">$</span>pork <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
stegen<span style="color:#f92672">$</span>salmon[stegen<span style="color:#f92672">$</span>salmon <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span>
stegen<span style="color:#f92672">$</span>horseradish[stegen<span style="color:#f92672">$</span>horseradish <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span></code></pre></div>
<p><details></p>

<p><summary> <b> Going further </b> Why does this work? Click here for more
details. </summary></p>

<p>There are several things going on in a command like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen<span style="color:#f92672">$</span>pork[stegen<span style="color:#f92672">$</span>pork <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">NA</span></code></pre></div>
<p>let us break them down from the inside out.</p>

<ol>
<li><code>stegen$pork</code> means “get the variable called <code>pork</code> in the dataset
<code>stegen</code>”</li>
<li>The <code>==</code> is a logical test for equality. <code>stegen$pork == 9</code> tests
each element in <code>stegen$pork</code> if it’s equal to <code>9</code>, returning <code>TRUE</code>
if an element of <code>stegen$pork</code> is equal to <code>9</code> and <code>FALSE</code> if it
doesn’t.</li>
<li>The square brackets (<code>[ ]</code>) subset the vector <code>stegen$pork</code>
according to whatever is between them; In this case, it’s the test
<code>stegen$pork == 9</code>, which evaluates to FALSE, FALSE, FALSE, TRUE,
FALSE, FALSE… This will return only the cases in <code>stegen$pork</code> that
have <code>9</code>s recorded.</li>
<li>The replacement: <code>... &lt;- NA</code> replace <code>...</code> with <code>NA</code> (missing value)</li>
</ol>

<p>in other words: &ldquo;isolate the entries of <code>stegen$pork</code> which equal <code>9</code>,
and replace them with <code>NA</code>; here is another toy example to illustrate
the procedure:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">## make toy input vector</span>
toy_vector <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>
toy_vector
<span style="color:#75715e">## [1] 1 2 3 4 5</span>

<span style="color:#75715e">## make toy logical vector for subsetting</span>
toy_logical <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">c</span>(<span style="color:#66d9ef">FALSE</span>, <span style="color:#66d9ef">TRUE</span>, <span style="color:#66d9ef">TRUE</span>, <span style="color:#66d9ef">FALSE</span>, <span style="color:#66d9ef">TRUE</span>)
toy_logical
<span style="color:#75715e">## [1] FALSE  TRUE  TRUE FALSE  TRUE</span>
toy_vector[toy_logical] <span style="color:#75715e"># subset values</span>
<span style="color:#75715e">## [1] 2 3 5</span>
toy_vector[toy_logical] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># replace subset values</span>
toy_vector <span style="color:#75715e"># check outcome</span>
<span style="color:#75715e">## [1] 1 0 0 4 0</span></code></pre></div>
<p></details></p>

<h2 id="saving-clean-data">Saving clean data</h2>

<p>Now that we’ve cleaned our data, we will probably want to re-use it in
further analyses, but we probably don’t want to go through the steps of
cleaning it again. Here, we will save our cleaned data into a new folder
under <code>data/</code> called <code>cleaned/</code>. We will use <strong>R</strong>’s function
<code>dir.create()</code> to create this folder under our data folder:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">clean_dir <span style="color:#f92672">&lt;-</span> here(<span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;cleaned&#34;</span>)
<span style="color:#66d9ef">dir.create</span>(clean_dir)</code></pre></div>
<blockquote>
<p>STOP: open your file browser and confirm that file called
“data/cleaned” has been created</p>
</blockquote>

<p>We will store two different files in this directory that represent the
same data:</p>

<ol>
<li>a flat text file (spreadsheet) that can be read by any program</li>
<li>a binary file that can only be accessed from R</li>
</ol>

<h3 id="saving-as-a-flat-file">Saving as a flat file</h3>

<p>A flat file is a text file that can be read by any program. The most
common type of flat file is a called a <strong>csv</strong> (comma separated values)
file. This is a text version of a spreadsheet with commas denoting the
columns. We can use the <code>write_csv()</code> function from the <em>readr</em> package
to do this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen_clean_file <span style="color:#f92672">&lt;-</span> here(<span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;cleaned&#34;</span>, <span style="color:#e6db74">&#34;stegen_clean.csv&#34;</span>)
write_csv(stegen, path <span style="color:#f92672">=</span> stegen_clean_file)</code></pre></div>
<p>When you want to read in the file later, you can use the <code>read_csv()</code>
function.</p>

<h3 id="saving-as-a-binary-file">Saving as a binary file</h3>

<p>When you save as a flat file, you will have to re-define which varaibles
are dates and which are factors when you re-read in the clean data. One
way to avoid doing this is to save your data into a file called an
<strong>RDS</strong> file, which is a data file that only R can read. This will
preserve your column definitions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen_clean_rds <span style="color:#f92672">&lt;-</span> here(<span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;cleaned&#34;</span>, <span style="color:#e6db74">&#34;stegen_clean.rds&#34;</span>)
<span style="color:#66d9ef">saveRDS</span>(stegen, file <span style="color:#f92672">=</span> stegen_clean_rds)</code></pre></div>
<p>To read in the clean data for later use, we would use the <code>readRDS()</code>
function.</p>

<h1 id="data-exploration">Data exploration</h1>

<h2 id="summaries-of-age-and-sex-distribution">Summaries of age and sex distribution</h2>

<p>It is good practice to first start to explore and familiarise yourself
with a dataset before heading into the analyses of your data. We can
have a brief look at age and sex distributions using some basic
summaries; for instance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">summary</span>(stegen<span style="color:#f92672">$</span>age) <span style="color:#75715e"># age stats</span>
<span style="color:#75715e">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span>
<span style="color:#75715e">##   12.00   18.00   20.00   26.66   27.00   80.00       8</span>
<span style="color:#66d9ef">summary</span>(stegen<span style="color:#f92672">$</span>sex) <span style="color:#75715e"># gender distribution</span>
<span style="color:#75715e">##   male female </span>
<span style="color:#75715e">##    139    152</span>
<span style="color:#66d9ef">tapply</span>(stegen<span style="color:#f92672">$</span>age, INDEX <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>sex, FUN <span style="color:#f92672">=</span> <span style="color:#66d9ef">summary</span>) <span style="color:#75715e"># age stats by gender      </span>
<span style="color:#75715e">## $male</span>
<span style="color:#75715e">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span>
<span style="color:#75715e">##   12.00   17.50   19.00   26.38   28.00   80.00       4 </span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $female</span>
<span style="color:#75715e">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span>
<span style="color:#75715e">##   13.00   18.00   20.00   26.93   24.50   65.00       4</span></code></pre></div>
<p><details></p>

<p><summary> <b>Going further</b> click here to learn about
<code>tapply()</code>: </summary></p>

<p><code>tapply()</code> is a very handy function to stratify any kind of analyses.
You will find more details by reading the documentation of the function
<code>?tapply()</code>, but briefly, the syntax to be used is <code>tapply(input_data,
stratification, function_to_use, further_arguments)</code>. In the command
used above:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">tapply</span>(stegen<span style="color:#f92672">$</span>age, INDEX <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>sex, FUN <span style="color:#f92672">=</span> <span style="color:#66d9ef">summary</span>)</code></pre></div>
<p>this literally means: select the age variable in the dataset <code>stegen</code>
(<code>stegen$age</code>), stratify it by sex (<code>stegen$sex</code>), and summarise each
stratum (<code>summary()</code>). So for instance, to get the average age by sex
(function <code>mean()</code>), one could use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">tapply</span>(stegen<span style="color:#f92672">$</span>age, INDEX <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>sex, FUN <span style="color:#f92672">=</span> <span style="color:#66d9ef">mean</span>, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#75715e">##     male   female </span>
<span style="color:#75715e">## 26.37778 26.92568</span></code></pre></div>
<p>Here we illustrate that further arguments to the function <code>mean()</code> can
be passed on; here, <code>na.rm = TRUE</code> means “ignore missing data”.</p>

<p></details></p>

<h2 id="graphical-exploration">Graphical exploration</h2>

<p>The summaries above may be useful for reporting purposes, but graphics
are usually better for getting a feel for the data. Here, we illustrate
how the package <em>ggplot2</em> can be used to derive informative graphics of
age/sex distribution. It implements an alternative graphics system to
the basic <strong>R</strong> plots, in which the plot is built by adding (literally
using <code>+</code>) different layers of information, using:</p>

<ul>
<li><code>ggplot()</code> to specify the dataset to use</li>
<li><code>geom_...()</code> functions which define a type of graphics to use
(e.g. barplot, histogram)</li>
<li><code>aes()</code> to map elements of the data into aesthetic properties
(e.g. x/y axes, color, shape)</li>
</ul>

<p>For instance, to get an histogram of age:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">ggplot(stegen) <span style="color:#f92672">+</span> geom_histogram(aes(x <span style="color:#f92672">=</span> age))
<span style="color:#75715e">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/stegen_histogram-1.png" alt="" /><!-- --></p>

<p><details></p>

<p><summary>What does “<code>stat_bin()</code> using <code>bins = 30</code>. Pick better value
with <code>binwidth</code>” mean?</summary></p>

<p>This is a message that came from <code>geom_histogram()</code>. If we look at the
help documentation for <code>geom_histogram()</code>, we can see this paragraph in
the <strong>Details</strong> section:</p>

<blockquote>
<p>By default, the underlying computation (‘stat_bin()’) uses 30 bins;
this is not a good default, but the idea is to get you experimenting
with different bin widths. You may need to look at a few to uncover
the full story behind your data.</p>
</blockquote>

<p>Each bar in a histogram is considered a “bin”. The height of each bar is
the number of observations that fall within the bounds of that bar.
Because we are looking at age, it may be better for us to define a
binwidth of 1 so that each bar represents a single
year.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">ggplot(stegen) <span style="color:#f92672">+</span> geom_histogram(aes(x <span style="color:#f92672">=</span> age), binwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/stegen_histogram-bin-1.png" alt="" /><!-- --></p>

<p></details></p>

<p>We can differentiate between genders by filling the bars with color
(n.b. we are also setting the binwidth to be 1
year):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">ggplot(stegen) <span style="color:#f92672">+</span> geom_histogram(aes(x <span style="color:#f92672">=</span> age, fill <span style="color:#f92672">=</span> sex), binwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/stegen_histogram_sex-1.png" alt="" /><!-- --></p>

<p>Here, the age distribution is pretty much identical between male and
female.</p>

<p><details></p>

<p><summary> <b> Going further:</b> click here to learn about customising
<i>ggplot2</i> graphics:</summary></p>

<p><em>ggplot2</em> graphics are highly customisable, and a lot of help and
examples can be found online. The <a href="https://ggplot2.tidyverse.org/">official
website</a> is a good place to start.</p>

<p>For instance, here we:</p>

<ul>
<li>define the width of each bin to be 1 year (<code>binwidth = 1</code> to avoid
the warning from above)</li>
<li>add white borders to the plot (<code>color = &quot;white&quot;</code>)</li>
<li>specify colors manually for male / female, using specified color
codes (see <a href="https://www.w3schools.com/colors/colors_picker.asp">html color
picker</a> to
define your own colors) (<code>scale_fill_manual(...)</code>)</li>
<li>add labels for title, <em>x</em> and <em>y</em> axes (<code>labs()</code>)</li>
<li>specify a lighter general color theme, using Times font of a larger
size by default (<code>theme_light(...)</code>)</li>
<li>move the legend inside the plot (<code>theme(...)</code>)</li>
</ul>

<p>Note, it’s best practice to include only one <em>ggplot2</em> command per line
if you are using more than two.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">ggplot(stegen) <span style="color:#f92672">+</span> 
  geom_histogram(aes(x <span style="color:#f92672">=</span> age, fill <span style="color:#f92672">=</span> sex), binwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>) <span style="color:#f92672">+</span>
  scale_fill_manual(values <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(male <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#4775d1&#34;</span>, female <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#cc6699&#34;</span>)) <span style="color:#f92672">+</span>
  labs(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Age distribution by gender&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Age (years)&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Number of cases&#34;</span>) <span style="color:#f92672">+</span>
  theme_light(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Times&#34;</span>, base_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">+</span>
  theme(legend.position <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">0.8</span>, <span style="color:#ae81ff">0.8</span>))</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/stegen_ggplot2_custom-1.png" alt="" /><!-- --></p>

<p></details></p>

<h2 id="epidemic-curve">Epidemic curve</h2>

<p>Incidence curves can be built using the package <em>incidence</em>, which will
compute the number of new cases given a vector of dates (here, onset)
and a time interval (1 day by default). We use the function
<code>incidence()</code> to achieve this, and then visualise the results:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">i <span style="color:#f92672">&lt;-</span> incidence(stegen<span style="color:#f92672">$</span>date_onset)
<span style="color:#75715e">## 160 missing observations were removed.</span>
i
<span style="color:#75715e">## &lt;incidence object&gt;</span>
<span style="color:#75715e">## [131 cases from days 1998-06-26 to 1998-07-09]</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $counts: matrix with 14 rows and 1 columns</span>
<span style="color:#75715e">## $n: 131 cases in total</span>
<span style="color:#75715e">## $dates: 14 dates marking the left-side of bins</span>
<span style="color:#75715e">## $interval: 1 day</span>
<span style="color:#75715e">## $timespan: 14 days</span>
<span style="color:#75715e">## $cumulative: FALSE</span>
plot(i)</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/stegen_incidence-1.png" alt="" /><!-- --></p>

<p>Details of the case counts can be obtained using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">as.data.frame</span>(i)
<span style="color:#75715e">##         dates counts</span>
<span style="color:#75715e">## 1  1998-06-26      1</span>
<span style="color:#75715e">## 2  1998-06-27     56</span>
<span style="color:#75715e">## 3  1998-06-28     51</span>
<span style="color:#75715e">## 4  1998-06-29     10</span>
<span style="color:#75715e">## 5  1998-06-30      3</span>
<span style="color:#75715e">## 6  1998-07-01      3</span>
<span style="color:#75715e">## 7  1998-07-02      3</span>
<span style="color:#75715e">## 8  1998-07-03      0</span>
<span style="color:#75715e">## 9  1998-07-04      1</span>
<span style="color:#75715e">## 10 1998-07-05      1</span>
<span style="color:#75715e">## 11 1998-07-06      1</span>
<span style="color:#75715e">## 12 1998-07-07      0</span>
<span style="color:#75715e">## 13 1998-07-08      0</span>
<span style="color:#75715e">## 14 1998-07-09      1</span></code></pre></div>
<p>How long is this outbreak? It looks like most cases occurred over the
course of 3 days, but that cases kept showing up 10 days after the peak.
Is this true? Not really. Stratifying the epidemic curve by case
definition will clarify the situation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">i_ill <span style="color:#f92672">&lt;-</span> incidence(stegen<span style="color:#f92672">$</span>date_onset, group <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>ill)
<span style="color:#75715e">## 160 missing observations were removed.</span>
i_ill
<span style="color:#75715e">## &lt;incidence object&gt;</span>
<span style="color:#75715e">## [131 cases from days 1998-06-26 to 1998-07-09]</span>
<span style="color:#75715e">## [2 groups: case, non case]</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $counts: matrix with 14 rows and 2 columns</span>
<span style="color:#75715e">## $n: 131 cases in total</span>
<span style="color:#75715e">## $dates: 14 dates marking the left-side of bins</span>
<span style="color:#75715e">## $interval: 1 day</span>
<span style="color:#75715e">## $timespan: 14 days</span>
<span style="color:#75715e">## $cumulative: FALSE</span>
<span style="color:#66d9ef">as.data.frame</span>(i_ill)
<span style="color:#75715e">##         dates case non case</span>
<span style="color:#75715e">## 1  1998-06-26    0        1</span>
<span style="color:#75715e">## 2  1998-06-27   48        8</span>
<span style="color:#75715e">## 3  1998-06-28   46        5</span>
<span style="color:#75715e">## 4  1998-06-29    8        2</span>
<span style="color:#75715e">## 5  1998-06-30    0        3</span>
<span style="color:#75715e">## 6  1998-07-01    0        3</span>
<span style="color:#75715e">## 7  1998-07-02    0        3</span>
<span style="color:#75715e">## 8  1998-07-03    0        0</span>
<span style="color:#75715e">## 9  1998-07-04    0        1</span>
<span style="color:#75715e">## 10 1998-07-05    0        1</span>
<span style="color:#75715e">## 11 1998-07-06    0        1</span>
<span style="color:#75715e">## 12 1998-07-07    0        0</span>
<span style="color:#75715e">## 13 1998-07-08    0        0</span>
<span style="color:#75715e">## 14 1998-07-09    0        1</span>
plot(i_ill, color <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#e6db74">&#34;non case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#66cc99&#34;</span>, <span style="color:#e6db74">&#34;case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#993333&#34;</span>))</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/incidence_stratified-1.png" alt="" /><!-- --></p>

<p>The outbreak really only happened over 3 days: onsets reported after did
not match the epi case definition. This is compatible with a food-borne
outbreak with limited or no person-to-person transmission.</p>

<p>Note that the plots produced by <em>incidence</em> are <em>ggplot2</em> objects, so
that the options seen before can be used for further customisation (see
below).</p>

<p><details></p>

<p><summary> <b> Going further</b> click here to learn about the
<i>incidence</i> package: </summary></p>

<p>More information on the <em>incidence</em> package can be found from the
<a href="https://www.repidemicsconsortium.org/incidence/">dedicated website</a>.
Here, we illustrate how incidence can be stratified e.g. by case
definition:</p>

<p>We can also customise this graphic like other <em>ggplot2</em> plots (see <a href="https://www.repidemicsconsortium.org/incidence/articles/customize_plot.html">this
tutorial</a>
for
more):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">plot(i_ill, border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#e6db74">&#34;non case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#66cc99&#34;</span>, <span style="color:#e6db74">&#34;case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#993333&#34;</span>)) <span style="color:#f92672">+</span> 
  geom_hline(yintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">55</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>) <span style="color:#f92672">+</span>
  labs(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Epicurve by case&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Date of onset&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Number of cases&#34;</span>) <span style="color:#f92672">+</span>
  theme_light(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Times&#34;</span>, base_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>) <span style="color:#f92672">+</span>
  theme(legend.position <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#ae81ff">0.8</span>, <span style="color:#ae81ff">0.8</span>)) <span style="color:#f92672">+</span>
  theme(axis.text.x <span style="color:#f92672">=</span> element_text(angle <span style="color:#f92672">=</span> <span style="color:#ae81ff">45</span>, hjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, vjust <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>))</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/incidence_stratified_custom-1.png" alt="" /><!-- --></p>

<p></details></p>

<h2 id="age-and-gender-distribution-of-the-cases">Age and gender distribution of the cases</h2>

<p>We use the same principles as before to visualise the distribution of
illness by age and gender. To split the plot into different panels
according to <code>sex</code>, we use <code>facet_grid()</code> (see previous extra info on
<em>ggplot2</em> customisation for further details otions):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">ggplot(stegen) <span style="color:#f92672">+</span> 
  geom_histogram(aes(x <span style="color:#f92672">=</span> age, fill <span style="color:#f92672">=</span> ill), binwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  scale_fill_manual(<span style="color:#e6db74">&#34;Illness&#34;</span>, values <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#e6db74">&#34;non case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#66cc99&#34;</span>, <span style="color:#e6db74">&#34;case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#993333&#34;</span>)) <span style="color:#f92672">+</span>
  facet_grid(sex <span style="color:#f92672">~</span> <span style="color:#ae81ff">.</span>) <span style="color:#f92672">+</span> 
  labs(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Cases by age and gender&#34;</span>) <span style="color:#f92672">+</span> 
  theme_light()</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/stegen_case_age_sex-1.png" alt="" /><!-- --></p>

<p>From these graphics, we can see that illness does not appear to depend
on age or gender, which suggests that the illness was caused by one or
more of the foods consumed. We will explore this with a risk ratio
analysis in the next section.</p>

<hr />

<h1 id="looking-for-the-culprits">Looking for the culprits</h1>

<p>In order to figure out which food item was responsible for the outbreak,
we need to test the <a href="https://en.wikipedia.org/wiki/Risk_ratio">Risk
Ratio</a> for all of the food
items recorded. Risk ratios are normally computed on <em>contingency</em>
tables (commonly known as 2x2 tables). In this part, we will compute
contingency tables for each predictor (food item) against the defined
cases, calculate their risk ratio with confidence intervals and
p-values, and plot them as points and errorbars using <em>ggplot2</em>.</p>

<h2 id="reading-in-clean-data">Reading in clean data</h2>

<p>In the section on saving clean data, we saved a binary file with our
stegen data set. If you are starting here, you will want to read this
file in with <code>readRDS()</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen_clean_rds <span style="color:#f92672">&lt;-</span> here(<span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;cleaned&#34;</span>, <span style="color:#e6db74">&#34;stegen_clean.rds&#34;</span>)
stegen <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">readRDS</span>(stegen_clean_rds)
<span style="color:#66d9ef">head</span>(stegen)</code></pre></div>
<pre><code>## # A tibble: 6 x 23
##   unique_key ill   date_onset sex     age tiramisu tportion wmousse dmousse
##   &lt;chr&gt;      &lt;fct&gt; &lt;date&gt;     &lt;fct&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 210        case  1998-06-27 fema…    18        1        3       0       1
## 2 12         case  1998-06-27 male     57        1        1       0       1
## 3 288        case  1998-06-27 fema…    56        0        0       0       0
## 4 186        case  1998-06-27 male     17        1        1       1       0
## 5 20         case  1998-06-27 fema…    19        1        2       0       0
## 6 148        case  1998-06-27 male     16        1        2       1       1
## # ... with 14 more variables: mousse &lt;dbl&gt;, mportion &lt;dbl&gt;, beer &lt;dbl&gt;,
## #   redjelly &lt;dbl&gt;, fruit_salad &lt;dbl&gt;, tomato &lt;dbl&gt;, mince &lt;dbl&gt;,
## #   salmon &lt;dbl&gt;, horseradish &lt;dbl&gt;, chickenwin &lt;dbl&gt;, roastbeef &lt;dbl&gt;,
## #   pork &lt;dbl&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;
</code></pre>

<h3 id="isolating-the-variables-to-test">Isolating the variables to test</h3>

<p>Because not all of the columns in our data set are food items (i.e.
“age”, and “tportion”), we only want to keep the columns that are
food items for our analysis.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">names</span>(stegen)
<span style="color:#75715e">##  [1] &#34;unique_key&#34;  &#34;ill&#34;         &#34;date_onset&#34;  &#34;sex&#34;         &#34;age&#34;        </span>
<span style="color:#75715e">##  [6] &#34;tiramisu&#34;    &#34;tportion&#34;    &#34;wmousse&#34;     &#34;dmousse&#34;     &#34;mousse&#34;     </span>
<span style="color:#75715e">## [11] &#34;mportion&#34;    &#34;beer&#34;        &#34;redjelly&#34;    &#34;fruit_salad&#34; &#34;tomato&#34;     </span>
<span style="color:#75715e">## [16] &#34;mince&#34;       &#34;salmon&#34;      &#34;horseradish&#34; &#34;chickenwin&#34;  &#34;roastbeef&#34;  </span>
<span style="color:#75715e">## [21] &#34;pork&#34;        &#34;latitude&#34;    &#34;longitude&#34;</span></code></pre></div>
<p>In this case, we need to retain columns 6 to 21, excluding <code>tportion</code>
and <code>mportion</code>, which are not binary; this can be done using the
subsetting brackets <code>[ ]</code>, where we will place character vector
indicating the columns we want to
keep.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">to_keep <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">c</span>(<span style="color:#e6db74">&#39;tiramisu&#39;</span>, <span style="color:#e6db74">&#39;wmousse&#39;</span>, <span style="color:#e6db74">&#39;dmousse&#39;</span>, <span style="color:#e6db74">&#39;mousse&#39;</span>, <span style="color:#e6db74">&#39;beer&#39;</span>, <span style="color:#e6db74">&#39;redjelly&#39;</span>,
             <span style="color:#e6db74">&#39;fruit_salad&#39;</span>, <span style="color:#e6db74">&#39;tomato&#39;</span>, <span style="color:#e6db74">&#39;mince&#39;</span>, <span style="color:#e6db74">&#39;salmon&#39;</span>, <span style="color:#e6db74">&#39;horseradish&#39;</span>,
             <span style="color:#e6db74">&#39;chickenwin&#39;</span>, <span style="color:#e6db74">&#39;roastbeef&#39;</span>, <span style="color:#e6db74">&#39;pork&#39;</span>) 
to_keep
<span style="color:#75715e">##  [1] &#34;tiramisu&#34;    &#34;wmousse&#34;     &#34;dmousse&#34;     &#34;mousse&#34;      &#34;beer&#34;       </span>
<span style="color:#75715e">##  [6] &#34;redjelly&#34;    &#34;fruit_salad&#34; &#34;tomato&#34;      &#34;mince&#34;       &#34;salmon&#34;     </span>
<span style="color:#75715e">## [11] &#34;horseradish&#34; &#34;chickenwin&#34;  &#34;roastbeef&#34;   &#34;pork&#34;</span>
food <span style="color:#f92672">&lt;-</span> stegen[to_keep]
food
<span style="color:#75715e">## # A tibble: 291 x 14</span>
<span style="color:#75715e">##    tiramisu wmousse dmousse mousse  beer redjelly fruit_salad tomato mince</span>
<span style="color:#75715e">##       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span>
<span style="color:#75715e">##  1        1       0       1      1     0        0           0      0     0</span>
<span style="color:#75715e">##  2        1       0       1      1     0        0           1      0     1</span>
<span style="color:#75715e">##  3        0       0       0      0     0        0           0      1     1</span>
<span style="color:#75715e">##  4        1       1       0      1     0        1           0      0     0</span>
<span style="color:#75715e">##  5        1       0       0      0     1        0           0      0     0</span>
<span style="color:#75715e">##  6        1       1       1      1     0        0           1      0     1</span>
<span style="color:#75715e">##  7        1       0       1      1     0        0           1      0     0</span>
<span style="color:#75715e">##  8        1       1       1      1     0        1           1      0     0</span>
<span style="color:#75715e">##  9        1       1       1      1     1        0           0      1     0</span>
<span style="color:#75715e">## 10        1       1       1      1     0        1           0      0     0</span>
<span style="color:#75715e">## # ... with 281 more rows, and 5 more variables: salmon &lt;dbl&gt;,</span>
<span style="color:#75715e">## #   horseradish &lt;dbl&gt;, chickenwin &lt;dbl&gt;, roastbeef &lt;dbl&gt;, pork &lt;dbl&gt;</span></code></pre></div>
<h2 id="risk-ratios">Risk ratios</h2>

<h3 id="for-one-variable">For one variable</h3>

<p>The <a href="https://en.wikipedia.org/wiki/Risk_ratio">risk ratio</a> is defined as
the ratio between the proportion of illness in one group (typically
‘exposed’) vs another (‘non-exposed’). For instance, let us consider
the contingency table of pork consumption and illness. One way to
calcuate a contingency table is using the <code>epitable()</code> function from the
<em>epitools</em> package:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">pork_table <span style="color:#f92672">&lt;-</span> epitable(food<span style="color:#f92672">$</span>pork, stegen<span style="color:#f92672">$</span>ill)
pork_table
<span style="color:#75715e">##          Outcome</span>
<span style="color:#75715e">## Predictor non case case</span>
<span style="color:#75715e">##         0      115   54</span>
<span style="color:#75715e">##         1       72   48</span></code></pre></div>
<p>We can get the risk ratio by using the <code>riskratio()</code> function from the
<em>epitools</em> package. Here, we want to use Yates’ continuity correction
and calculate Wald confidence intervals (more information about this can
be found on the help page for <code>riskratio()</code> by typing <code>?riskratio</code> in
your R console).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">pork_rr <span style="color:#f92672">&lt;-</span> riskratio(pork_table, correct <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wald&#34;</span>)
pork_rr
<span style="color:#75715e">## $data</span>
<span style="color:#75715e">##          Outcome</span>
<span style="color:#75715e">## Predictor non case case Total</span>
<span style="color:#75715e">##     0          115   54   169</span>
<span style="color:#75715e">##     1           72   48   120</span>
<span style="color:#75715e">##     Total      187  102   289</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $measure</span>
<span style="color:#75715e">##          risk ratio with 95% C.I.</span>
<span style="color:#75715e">## Predictor estimate     lower    upper</span>
<span style="color:#75715e">##         0 1.000000        NA       NA</span>
<span style="color:#75715e">##         1 1.251852 0.9176849 1.707703</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $p.value</span>
<span style="color:#75715e">##          two-sided</span>
<span style="color:#75715e">## Predictor midp.exact fisher.exact chi.square</span>
<span style="color:#75715e">##         0         NA           NA         NA</span>
<span style="color:#75715e">##         1  0.1620037    0.1708777   0.198536</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $correction</span>
<span style="color:#75715e">## [1] TRUE</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## attr(,&#34;method&#34;)</span>
<span style="color:#75715e">## [1] &#34;Unconditional MLE &amp; normal approximation (Wald) CI&#34;</span></code></pre></div>
<p>The documentation of <code>riskratio()</code> shows that it returns quite a few
things as a list. However, we only want three things from this list:</p>

<ol>
<li>risk ratio estimate</li>
<li>95% confidence interval</li>
<li>P-value</li>
</ol>

<p><details></p>

<p><summary> <b>Going further:</b> What is a list? </summary></p>

<p><code>pork_rr</code> is an R object called a “list”:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">class</span>(pork_rr)
<span style="color:#75715e">## [1] &#34;list&#34;</span></code></pre></div>
<p>A list is an R vector that can hold other vectors. While this may look
strange and unfamiliar, we’ve actually seen lists before. If you look
close, you can see that each element of a list starts with a <code>$</code>. This
is the exact same syntax as data frames. If we inspect our <code>stegen</code> data
frame, we can see that it is actually a list:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#66d9ef">is.list</span>(stegen)
<span style="color:#75715e">## [1] TRUE</span>
<span style="color:#66d9ef">is.list</span>(pork_rr)
<span style="color:#75715e">## [1] TRUE</span></code></pre></div>
<p>Each column of a data frame is just a different element of a list. In
fact, we can use the <code>$</code> operator to access different elements of the
list just as we would the columns of a data frame:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen_list <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">as.list</span>(stegen)
<span style="color:#66d9ef">head</span>(stegen_list)
<span style="color:#75715e">## $unique_key</span>
<span style="color:#75715e">##   [1] &#34;210&#34; &#34;12&#34;  &#34;288&#34; &#34;186&#34; &#34;20&#34;  &#34;148&#34; &#34;201&#34; &#34;106&#34; &#34;272&#34; &#34;50&#34;  &#34;216&#34;</span>
<span style="color:#75715e">##  [12] &#34;141&#34; &#34;91&#34;  &#34;98&#34;  &#34;200&#34; &#34;109&#34; &#34;117&#34; &#34;281&#34; &#34;269&#34; &#34;77&#34;  &#34;196&#34; &#34;16&#34; </span>
<span style="color:#75715e">##  [23] &#34;168&#34; &#34;102&#34; &#34;204&#34; &#34;205&#34; &#34;271&#34; &#34;48&#34;  &#34;287&#34; &#34;25&#34;  &#34;15&#34;  &#34;45&#34;  &#34;125&#34;</span>
<span style="color:#75715e">##  [34] &#34;113&#34; &#34;284&#34; &#34;121&#34; &#34;52&#34;  &#34;207&#34; &#34;63&#34;  &#34;43&#34;  &#34;175&#34; &#34;214&#34; &#34;251&#34; &#34;213&#34;</span>
<span style="color:#75715e">##  [45] &#34;65&#34;  &#34;159&#34; &#34;29&#34;  &#34;14&#34;  &#34;165&#34; &#34;145&#34; &#34;202&#34; &#34;255&#34; &#34;169&#34; &#34;274&#34; &#34;254&#34;</span>
<span style="color:#75715e">##  [56] &#34;61&#34;  &#34;2&#34;   &#34;86&#34;  &#34;59&#34;  &#34;74&#34;  &#34;133&#34; &#34;115&#34; &#34;103&#34; &#34;138&#34; &#34;70&#34;  &#34;173&#34;</span>
<span style="color:#75715e">##  [67] &#34;144&#34; &#34;212&#34; &#34;234&#34; &#34;156&#34; &#34;146&#34; &#34;152&#34; &#34;31&#34;  &#34;279&#34; &#34;36&#34;  &#34;75&#34;  &#34;286&#34;</span>
<span style="color:#75715e">##  [78] &#34;215&#34; &#34;56&#34;  &#34;199&#34; &#34;154&#34; &#34;27&#34;  &#34;42&#34;  &#34;49&#34;  &#34;96&#34;  &#34;66&#34;  &#34;104&#34; &#34;13&#34; </span>
<span style="color:#75715e">##  [89] &#34;221&#34; &#34;51&#34;  &#34;177&#34; &#34;111&#34; &#34;242&#34; &#34;143&#34; &#34;278&#34; &#34;62&#34;  &#34;176&#34; &#34;134&#34; &#34;256&#34;</span>
<span style="color:#75715e">## [100] &#34;55&#34;  &#34;235&#34; &#34;58&#34;  &#34;194&#34; &#34;282&#34; &#34;137&#34; &#34;118&#34; &#34;220&#34; &#34;24&#34;  &#34;187&#34; &#34;190&#34;</span>
<span style="color:#75715e">## [111] &#34;189&#34; &#34;195&#34; &#34;231&#34; &#34;239&#34; &#34;289&#34; &#34;184&#34; &#34;126&#34; &#34;209&#34; &#34;290&#34; &#34;67&#34;  &#34;170&#34;</span>
<span style="color:#75715e">## [122] &#34;230&#34; &#34;151&#34; &#34;283&#34; &#34;211&#34; &#34;69&#34;  &#34;35&#34;  &#34;233&#34; &#34;208&#34; &#34;155&#34; &#34;198&#34; &#34;40&#34; </span>
<span style="color:#75715e">## [133] &#34;119&#34; &#34;139&#34; &#34;180&#34; &#34;188&#34; &#34;157&#34; &#34;80&#34;  &#34;203&#34; &#34;280&#34; &#34;37&#34;  &#34;193&#34; &#34;53&#34; </span>
<span style="color:#75715e">## [144] &#34;22&#34;  &#34;85&#34;  &#34;232&#34; &#34;258&#34; &#34;265&#34; &#34;54&#34;  &#34;237&#34; &#34;266&#34; &#34;236&#34; &#34;88&#34;  &#34;10&#34; </span>
<span style="color:#75715e">## [155] &#34;11&#34;  &#34;174&#34; &#34;185&#34; &#34;161&#34; &#34;226&#34; &#34;273&#34; &#34;227&#34; &#34;260&#34; &#34;223&#34; &#34;107&#34; &#34;183&#34;</span>
<span style="color:#75715e">## [166] &#34;250&#34; &#34;253&#34; &#34;44&#34;  &#34;182&#34; &#34;228&#34; &#34;285&#34; &#34;83&#34;  &#34;248&#34; &#34;136&#34; &#34;172&#34; &#34;46&#34; </span>
<span style="color:#75715e">## [177] &#34;114&#34; &#34;166&#34; &#34;164&#34; &#34;101&#34; &#34;21&#34;  &#34;158&#34; &#34;108&#34; &#34;34&#34;  &#34;276&#34; &#34;222&#34; &#34;130&#34;</span>
<span style="color:#75715e">## [188] &#34;275&#34; &#34;72&#34;  &#34;218&#34; &#34;267&#34; &#34;76&#34;  &#34;241&#34; &#34;171&#34; &#34;142&#34; &#34;89&#34;  &#34;105&#34; &#34;39&#34; </span>
<span style="color:#75715e">## [199] &#34;167&#34; &#34;140&#34; &#34;124&#34; &#34;131&#34; &#34;17&#34;  &#34;73&#34;  &#34;97&#34;  &#34;5&#34;   &#34;123&#34; &#34;9&#34;   &#34;99&#34; </span>
<span style="color:#75715e">## [210] &#34;84&#34;  &#34;229&#34; &#34;116&#34; &#34;238&#34; &#34;217&#34; &#34;122&#34; &#34;240&#34; &#34;95&#34;  &#34;110&#34; &#34;41&#34;  &#34;206&#34;</span>
<span style="color:#75715e">## [221] &#34;23&#34;  &#34;257&#34; &#34;163&#34; &#34;64&#34;  &#34;100&#34; &#34;120&#34; &#34;160&#34; &#34;224&#34; &#34;94&#34;  &#34;60&#34;  &#34;263&#34;</span>
<span style="color:#75715e">## [232] &#34;191&#34; &#34;147&#34; &#34;179&#34; &#34;93&#34;  &#34;57&#34;  &#34;112&#34; &#34;268&#34; &#34;243&#34; &#34;219&#34; &#34;247&#34; &#34;38&#34; </span>
<span style="color:#75715e">## [243] &#34;33&#34;  &#34;68&#34;  &#34;4&#34;   &#34;150&#34; &#34;79&#34;  &#34;178&#34; &#34;127&#34; &#34;153&#34; &#34;261&#34; &#34;92&#34;  &#34;90&#34; </span>
<span style="color:#75715e">## [254] &#34;264&#34; &#34;277&#34; &#34;181&#34; &#34;197&#34; &#34;225&#34; &#34;18&#34;  &#34;1&#34;   &#34;252&#34; &#34;47&#34;  &#34;245&#34; &#34;78&#34; </span>
<span style="color:#75715e">## [265] &#34;162&#34; &#34;81&#34;  &#34;3&#34;   &#34;82&#34;  &#34;32&#34;  &#34;71&#34;  &#34;30&#34;  &#34;28&#34;  &#34;135&#34; &#34;246&#34; &#34;149&#34;</span>
<span style="color:#75715e">## [276] &#34;7&#34;   &#34;19&#34;  &#34;249&#34; &#34;128&#34; &#34;6&#34;   &#34;192&#34; &#34;270&#34; &#34;262&#34; &#34;259&#34; &#34;87&#34;  &#34;8&#34;  </span>
<span style="color:#75715e">## [287] &#34;129&#34; &#34;26&#34;  &#34;132&#34; &#34;244&#34; &#34;291&#34;</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $ill</span>
<span style="color:#75715e">##   [1] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##   [8] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [15] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [22] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [29] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [36] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [43] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [50] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [57] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [64] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [71] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [78] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [85] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [92] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [99] non case non case non case non case case     non case non case</span>
<span style="color:#75715e">## [106] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [113] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [120] non case non case non case case     non case non case non case</span>
<span style="color:#75715e">## [127] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [134] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [141] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [148] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [155] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [162] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [169] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [176] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [183] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [190] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [197] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [204] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [211] non case non case case     non case non case non case non case</span>
<span style="color:#75715e">## [218] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [225] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [232] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [239] non case non case non case non case non case case     non case</span>
<span style="color:#75715e">## [246] case     non case non case non case non case non case non case</span>
<span style="color:#75715e">## [253] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [260] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [267] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [274] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [281] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [288] non case non case non case non case</span>
<span style="color:#75715e">## Levels: non case case</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $date_onset</span>
<span style="color:#75715e">##   [1] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##   [6] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##  [11] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##  [16] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##  [21] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##  [26] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##  [31] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##  [36] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##  [41] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-27&#34;</span>
<span style="color:#75715e">##  [46] &#34;1998-06-27&#34; &#34;1998-06-27&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [51] &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [56] &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [61] &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [66] &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [71] &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [76] &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [81] &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [86] &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34; &#34;1998-06-28&#34;</span>
<span style="color:#75715e">##  [91] &#34;1998-06-29&#34; &#34;1998-06-29&#34; &#34;1998-06-29&#34; &#34;1998-06-29&#34; &#34;1998-06-29&#34;</span>
<span style="color:#75715e">##  [96] &#34;1998-06-29&#34; &#34;1998-06-29&#34; &#34;1998-06-29&#34; NA           NA          </span>
<span style="color:#75715e">## [101] &#34;1998-07-05&#34; NA           &#34;1998-06-27&#34; NA           NA          </span>
<span style="color:#75715e">## [106] NA           NA           &#34;1998-07-02&#34; NA           NA          </span>
<span style="color:#75715e">## [111] NA           &#34;1998-06-28&#34; NA           NA           NA          </span>
<span style="color:#75715e">## [116] NA           NA           NA           NA           &#34;1998-07-01&#34;</span>
<span style="color:#75715e">## [121] NA           NA           &#34;1998-06-28&#34; NA           NA          </span>
<span style="color:#75715e">## [126] NA           NA           NA           &#34;1998-06-30&#34; NA          </span>
<span style="color:#75715e">## [131] NA           NA           NA           &#34;1998-06-28&#34; NA          </span>
<span style="color:#75715e">## [136] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [141] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [146] NA           NA           NA           NA           &#34;1998-07-09&#34;</span>
<span style="color:#75715e">## [151] NA           NA           &#34;1998-06-29&#34; NA           &#34;1998-07-02&#34;</span>
<span style="color:#75715e">## [156] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [161] &#34;1998-07-06&#34; NA           NA           NA           NA          </span>
<span style="color:#75715e">## [166] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [171] NA           NA           &#34;1998-06-27&#34; NA           NA          </span>
<span style="color:#75715e">## [176] NA           NA           NA           &#34;1998-06-27&#34; NA          </span>
<span style="color:#75715e">## [181] NA           NA           NA           &#34;1998-06-28&#34; NA          </span>
<span style="color:#75715e">## [186] NA           NA           NA           NA           &#34;1998-06-30&#34;</span>
<span style="color:#75715e">## [191] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [196] &#34;1998-06-27&#34; NA           NA           &#34;1998-06-28&#34; NA          </span>
<span style="color:#75715e">## [201] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [206] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [211] &#34;1998-06-26&#34; NA           &#34;1998-06-28&#34; &#34;1998-06-27&#34; NA          </span>
<span style="color:#75715e">## [216] NA           NA           NA           &#34;1998-06-27&#34; NA          </span>
<span style="color:#75715e">## [221] NA           NA           &#34;1998-06-27&#34; &#34;1998-07-01&#34; NA          </span>
<span style="color:#75715e">## [226] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [231] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [236] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [241] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [246] &#34;1998-06-28&#34; &#34;1998-07-02&#34; NA           NA           NA          </span>
<span style="color:#75715e">## [251] NA           &#34;1998-06-27&#34; NA           NA           NA          </span>
<span style="color:#75715e">## [256] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [261] NA           NA           NA           &#34;1998-06-29&#34; &#34;1998-07-01&#34;</span>
<span style="color:#75715e">## [266] &#34;1998-06-27&#34; NA           &#34;1998-06-28&#34; NA           NA          </span>
<span style="color:#75715e">## [271] NA           &#34;1998-07-04&#34; NA           NA           NA          </span>
<span style="color:#75715e">## [276] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [281] NA           NA           NA           NA           NA          </span>
<span style="color:#75715e">## [286] NA           NA           &#34;1998-06-30&#34; NA           NA          </span>
<span style="color:#75715e">## [291] NA          </span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $sex</span>
<span style="color:#75715e">##   [1] female male   female male   female male   male   male   female male  </span>
<span style="color:#75715e">##  [11] female male   male   female male   male   male   male   female female</span>
<span style="color:#75715e">##  [21] male   female male   male   male   female male   female male   male  </span>
<span style="color:#75715e">##  [31] female female female male   female female male   male   female male  </span>
<span style="color:#75715e">##  [41] male   female male   male   female female male   female female female</span>
<span style="color:#75715e">##  [51] male   male   male   female female female male   male   female male  </span>
<span style="color:#75715e">##  [61] male   male   male   female female female female male   female female</span>
<span style="color:#75715e">##  [71] female female male   female male   male   male   female male   female</span>
<span style="color:#75715e">##  [81] female female male   male   female male   female male   female male  </span>
<span style="color:#75715e">##  [91] female female male   female male   male   female male   female male  </span>
<span style="color:#75715e">## [101] male   female male   male   male   female male   female female female</span>
<span style="color:#75715e">## [111] female male   female male   male   male   male   male   female male  </span>
<span style="color:#75715e">## [121] male   female female female female male   female female male   female</span>
<span style="color:#75715e">## [131] male   female male   male   female female female female male   male  </span>
<span style="color:#75715e">## [141] female male   female male   male   female male   female female female</span>
<span style="color:#75715e">## [151] female female female female female female female male   male   male  </span>
<span style="color:#75715e">## [161] male   female female male   female female female male   male   male  </span>
<span style="color:#75715e">## [171] female male   male   male   female male   male   female male   female</span>
<span style="color:#75715e">## [181] male   male   male   male   female female male   male   female male  </span>
<span style="color:#75715e">## [191] male   female female male   female female male   female female female</span>
<span style="color:#75715e">## [201] male   male   male   female female male   female female female male  </span>
<span style="color:#75715e">## [211] male   female male   female male   female male   male   male   male  </span>
<span style="color:#75715e">## [221] male   male   female male   male   male   female female male   female</span>
<span style="color:#75715e">## [231] female female male   male   male   male   female male   female female</span>
<span style="color:#75715e">## [241] female female female female female female male   female female female</span>
<span style="color:#75715e">## [251] female female male   female female female female male   female male  </span>
<span style="color:#75715e">## [261] female male   female male   male   female male   female female female</span>
<span style="color:#75715e">## [271] female male   female female male   male   female male   male   female</span>
<span style="color:#75715e">## [281] female female female male   female female female female male   female</span>
<span style="color:#75715e">## [291] male  </span>
<span style="color:#75715e">## Levels: male female</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $age</span>
<span style="color:#75715e">##   [1] 18 57 56 17 19 16 19 19 40 53 20 23 17 19 15 19 57 17 47 16 17 19 17</span>
<span style="color:#75715e">##  [24] 17 18 18 29 14 13 21 19 20 57 38 18 64 57 27 23 21 21 20 20 18 24 24</span>
<span style="color:#75715e">##  [47] 19 58 19 18 27 20 19 54 23 18 16 26 16 14 20 56 46 18 19 21 18 80 23</span>
<span style="color:#75715e">##  [70] 20 50 18 48 21 47 18 47 17 NA 52 20 32 17 16 17 20 19 19 NA 19 19 19</span>
<span style="color:#75715e">##  [93] 19 48 19 52 19 NA 21 18 20 19 39 17 22 13 20 18 17 17 62 17 21 54 20</span>
<span style="color:#75715e">## [116] 16 17 18 22 18 18 NA 19 17 20 57 20 20 48 19 44 19 46 51 17 16 22 18</span>
<span style="color:#75715e">## [139] 19 20 47 15 19 20 13 20 21 20 18 20 45 20 44 18 22 58 17 14 NA 20 20</span>
<span style="color:#75715e">## [162] NA 19 19 16 26 20 19 17 19 57 18 19 17 18 18 23 19 45 15 20 19 25 20</span>
<span style="color:#75715e">## [185] 20 20 48 23 17 17 46 19 21 18 24 18 52 50 23 55 19 16 18 19 50 49 65</span>
<span style="color:#75715e">## [208] 19 43 43 20 59 21 19 20 56 14 55 47 19 42 22 49 45 42 60 16 20 18 18</span>
<span style="color:#75715e">## [231] 21 19 19 17 17 18 45 58 20 24 57 19 20 56 46 18 17 37 44 19 21 19 18</span>
<span style="color:#75715e">## [254] 28 53 17 19 19 19 17 20 18 24 15 12 16 48 18 21 59 57 15 NA 20 18 18</span>
<span style="color:#75715e">## [277] 18 NA 16 20 16 51 18 21 22 18 18 21 17 21 22</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $tiramisu</span>
<span style="color:#75715e">##   [1]  1  1  0  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1</span>
<span style="color:#75715e">##  [24]  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1</span>
<span style="color:#75715e">##  [47]  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  0  1  1  1 NA  1</span>
<span style="color:#75715e">##  [70]  0  1  1 NA  1  1  1  1  1  1  1  1  1  1  1  0  1  1  0  1  1  1  1</span>
<span style="color:#75715e">##  [93]  1  0  1  1  1  1  0  0  0  0  0  0  0  0  1  0  1  0  0  1  0  0  0</span>
<span style="color:#75715e">## [116]  0  0  0 NA  1  0  0  1  0  0  0  0  0  1  0  0  0  0  1  0  0  0  0</span>
<span style="color:#75715e">## [139]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  0  0  0  0  1</span>
<span style="color:#75715e">## [162]  0  0  1  0  0  0  0  0  0  0  0  0  0  1  1  0  0  0  0  0  0  0  0</span>
<span style="color:#75715e">## [185]  0  0  0 NA  0  0  0  0  0  1  0  0  1  0  1  1  0  0  0  0  1  0  0</span>
<span style="color:#75715e">## [208]  0  0  0  0  0  1  0  0  1  0  0  0  0  1  0  0  1  0  0  0  1  1  0</span>
<span style="color:#75715e">## [231]  0  0  0  0  0  1  0  0  0  0  0  0  0  1  0  1  0  0  0  0  0  0  0</span>
<span style="color:#75715e">## [254]  0  0  1  0  0  0  1  0  0  0  1  0  0  0  0  0  0 NA  0  1  0  0  0</span>
<span style="color:#75715e">## [277]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1</span>
stegen_list<span style="color:#f92672">$</span>ill
<span style="color:#75715e">##   [1] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##   [8] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [15] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [22] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [29] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [36] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [43] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [50] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [57] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [64] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [71] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [78] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [85] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [92] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [99] non case non case non case non case case     non case non case</span>
<span style="color:#75715e">## [106] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [113] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [120] non case non case non case case     non case non case non case</span>
<span style="color:#75715e">## [127] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [134] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [141] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [148] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [155] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [162] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [169] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [176] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [183] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [190] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [197] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [204] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [211] non case non case case     non case non case non case non case</span>
<span style="color:#75715e">## [218] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [225] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [232] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [239] non case non case non case non case non case case     non case</span>
<span style="color:#75715e">## [246] case     non case non case non case non case non case non case</span>
<span style="color:#75715e">## [253] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [260] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [267] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [274] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [281] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [288] non case non case non case non case</span>
<span style="color:#75715e">## Levels: non case case</span>
stegen<span style="color:#f92672">$</span>ill
<span style="color:#75715e">##   [1] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##   [8] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [15] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [22] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [29] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [36] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [43] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [50] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [57] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [64] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [71] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [78] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [85] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [92] case     case     case     case     case     case     case    </span>
<span style="color:#75715e">##  [99] non case non case non case non case case     non case non case</span>
<span style="color:#75715e">## [106] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [113] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [120] non case non case non case case     non case non case non case</span>
<span style="color:#75715e">## [127] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [134] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [141] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [148] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [155] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [162] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [169] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [176] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [183] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [190] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [197] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [204] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [211] non case non case case     non case non case non case non case</span>
<span style="color:#75715e">## [218] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [225] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [232] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [239] non case non case non case non case non case case     non case</span>
<span style="color:#75715e">## [246] case     non case non case non case non case non case non case</span>
<span style="color:#75715e">## [253] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [260] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [267] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [274] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [281] non case non case non case non case non case non case non case</span>
<span style="color:#75715e">## [288] non case non case non case non case</span>
<span style="color:#75715e">## Levels: non case case</span></code></pre></div>
<p></details></p>

<p>All of these are present in the <code>pork_rr</code> object, but this output does
not lend itself well to quick visual inspection. What we can do now is
to <em>extract</em> elements from this output and place it in a data frame.</p>

<p>The first thing we want is the risk ratio and the confidence intervals
for those consumption of pork. This is presented in the <code>$measure</code>
element of the list:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">pork_rr<span style="color:#f92672">$</span>measure
<span style="color:#75715e">##          risk ratio with 95% C.I.</span>
<span style="color:#75715e">## Predictor estimate     lower    upper</span>
<span style="color:#75715e">##         0 1.000000        NA       NA</span>
<span style="color:#75715e">##         1 1.251852 0.9176849 1.707703</span>
<span style="color:#66d9ef">class</span>(pork_rr<span style="color:#f92672">$</span>measure)
<span style="color:#75715e">## [1] &#34;matrix&#34;</span></code></pre></div>
<p>We can see that this is present as a “matrix”. A matrix has rows and
columns and we can access them like we do a vector with square brackets
(<code>[ ]</code>), but we separate the rows and columns with a comma like so:
<code>[rows, columns]</code>. For example, if we wanted the risk ratio for pork
consumed, we would take the second row in the first column:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">pork_rr<span style="color:#f92672">$</span>measure[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>]
<span style="color:#75715e">## [1] 1.251852</span></code></pre></div>
<p>In our case, we want to take the entire second row, so we can leave the
<code>columns</code> portion blank:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">pork_est_ci <span style="color:#f92672">&lt;-</span> pork_rr<span style="color:#f92672">$</span>measure[<span style="color:#ae81ff">2</span>, ]
pork_est_ci
<span style="color:#75715e">##  estimate     lower     upper </span>
<span style="color:#75715e">## 1.2518519 0.9176849 1.7077027</span></code></pre></div>
<p>We also want to get the P-value, of which, we have three choices. In our
case, we will choose the P-value from Fisher’s exact test and combine
the result into a vector that we will turn into a data frame:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">pork_p <span style="color:#f92672">&lt;-</span> pork_rr<span style="color:#f92672">$</span>p.value[<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;fisher.exact&#34;</span>]
pork_p
<span style="color:#75715e">## [1] 0.1708777</span>
res <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">data.frame</span>(estimate <span style="color:#f92672">=</span> pork_est_ci[<span style="color:#e6db74">&#34;estimate&#34;</span>],
                  lower    <span style="color:#f92672">=</span> pork_est_ci[<span style="color:#e6db74">&#34;lower&#34;</span>],
                  upper    <span style="color:#f92672">=</span> pork_est_ci[<span style="color:#e6db74">&#34;upper&#34;</span>],
                  p.value  <span style="color:#f92672">=</span> pork_p
                 )
res
<span style="color:#75715e">##          estimate     lower    upper   p.value</span>
<span style="color:#75715e">## estimate 1.251852 0.9176849 1.707703 0.1708777</span></code></pre></div>
<p>Now we have a table that tells us that pork has a risk ratio of 1.252
CI: (0.918, 1.708), P = 0.171.</p>

<p><details></p>

<p><summary> Going Further: Different types of Univariate tests </summary></p>

<h2 id="univariate-tests">Univariate tests</h2>

<p>Methods for testing the association between two variables can be broken
down in 3 types, depending on which types these variables are:</p>

<ol>
<li><strong>2 categorical variables</strong>: Chi-squared test on the 2x2 table
(a.k.a. <em>contingency</em> table) and similar methods (e.g. Fisher’s
exact test)</li>
<li><strong>1 quantitative, 1 categorical</strong>: ANOVA types of approaches;
particular case with 2 groups: Student’s (t)-test</li>
<li><strong>2 quantitative variables</strong>: Pearson’s correlation coefficient
((r)) and similar methods</li>
</ol>

<p>We can use these approaches to test if the disease is linked to any of
the other recorded variables. As illness itself is a categorical
variable, only approaches of type 2 and 3 are illustrated in this case
study.</p>

<h3 id="is-illness-linked-to-age">Is illness linked to age?</h3>

<p>We can use the function <code>t.test()</code> to test if the average age is
different across illness status. As this test assumes that the two
categories exhibit similar variation, we first ensure that the variances
are comparable using Bartlett’s test. The syntax <code>variable ~ group</code> is
used to indicate the variable of interest (left hand-side), and the
group (right hand-side):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bartlett.test(stegen<span style="color:#f92672">$</span>age <span style="color:#f92672">~</span> stegen<span style="color:#f92672">$</span>ill)
<span style="color:#75715e">## </span>
<span style="color:#75715e">##  Bartlett test of homogeneity of variances</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## data:  stegen$age by stegen$ill</span>
<span style="color:#75715e">## Bartlett&#39;s K-squared = 0.82311, df = 1, p-value = 0.3643</span></code></pre></div>
<p>The resulting p-value (0.364) suggests the variances are indeed
comparable. We can thus proceed to a (t)-test:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">t.test(stegen<span style="color:#f92672">$</span>age <span style="color:#f92672">~</span> stegen<span style="color:#f92672">$</span>ill, var.equal <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#75715e">## </span>
<span style="color:#75715e">##  Two Sample t-test</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## data:  stegen$age by stegen$ill</span>
<span style="color:#75715e">## t = -0.55979, df = 281, p-value = 0.5761</span>
<span style="color:#75715e">## alternative hypothesis: true difference in means is not equal to 0</span>
<span style="color:#75715e">## 95 percent confidence interval:</span>
<span style="color:#75715e">##  -4.509729  2.512679</span>
<span style="color:#75715e">## sample estimates:</span>
<span style="color:#75715e">## mean in group non case     mean in group case </span>
<span style="color:#75715e">##               26.31148               27.31000</span></code></pre></div>
<p>The p-value of 0.576 confirms the previous graphics: the illness does
not seem to be linked to age.</p>

<h3 id="is-illness-linked-to-gender">Is illness linked to gender?</h3>

<p>To test the association between gender and illness (2 categorical
variables), we first build a 2-by-2 (contingency) table, using:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">tab_ill_sex <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">table</span>(stegen<span style="color:#f92672">$</span>ill, stegen<span style="color:#f92672">$</span>sex)
tab_ill_sex
<span style="color:#75715e">##           </span>
<span style="color:#75715e">##            male female</span>
<span style="color:#75715e">##   non case   86    102</span>
<span style="color:#75715e">##   case       53     50</span></code></pre></div>
<p>Note that proportions can be obtained using <code>prop.table</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">## basic proportions</span>
<span style="color:#66d9ef">prop.table</span>(tab_ill_sex)
<span style="color:#75715e">##           </span>
<span style="color:#75715e">##                 male    female</span>
<span style="color:#75715e">##   non case 0.2955326 0.3505155</span>
<span style="color:#75715e">##   case     0.1821306 0.1718213</span>

<span style="color:#75715e">## expressed in %, rounded:</span>
<span style="color:#66d9ef">round</span>(<span style="color:#ae81ff">100</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">prop.table</span>(tab_ill_sex))
<span style="color:#75715e">##           </span>
<span style="color:#75715e">##            male female</span>
<span style="color:#75715e">##   non case   30     35</span>
<span style="color:#75715e">##   case       18     17</span></code></pre></div>
<p>Once a contingency table has been built, the Chi-square test can be run
using <code>chisq.test</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">chisq.test(tab_ill_sex)
<span style="color:#75715e">## </span>
<span style="color:#75715e">##  Pearson&#39;s Chi-squared test with Yates&#39; continuity correction</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## data:  tab_ill_sex</span>
<span style="color:#75715e">## X-squared = 0.6562, df = 1, p-value = 0.4179</span></code></pre></div>
<p>Here, the p-value of 0.418 suggests illness is not related to gender
either.</p>

<p></details></p>

<h3 id="consolidating-several-steps-into-one-writing-functions">Consolidating several steps into one (writing functions)</h3>

<p>To recap, to get a risk ratio we’ve done the following:</p>

<ol>
<li>created a contingency table</li>
<li>estimated the risk ratio</li>
<li>extracted estimate into a data frame</li>
</ol>

<p>However, we have 14 potential predictors to sort through and we don’t
want to have to repeat these procedures manually over and over. One
strategy to help with this is to create our own <em>function</em>, which we can
think of as a miniature recipe for a computer to read. If we take the
steps above and place them into individual steps we would get:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">et  <span style="color:#f92672">&lt;-</span> epitable(food<span style="color:#f92672">$</span>pork, stegen<span style="color:#f92672">$</span>ill)
rr  <span style="color:#f92672">&lt;-</span> riskratio(et)
estimate <span style="color:#f92672">&lt;-</span> rr<span style="color:#f92672">$</span>measure[<span style="color:#ae81ff">2</span>, ]
res <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">data.frame</span>(estimate <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;estimate&#34;</span>],
                  lower    <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;lower&#34;</span>],
                  upper    <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;upper&#34;</span>],
                  p.value  <span style="color:#f92672">=</span> rr<span style="color:#f92672">$</span>p.value[<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;fisher.exact&#34;</span>]
                 )
res
<span style="color:#75715e">##          estimate     lower    upper   p.value</span>
<span style="color:#75715e">## estimate 1.251852 0.9176849 1.707703 0.1708777</span></code></pre></div>
<p>Just like a recipe, a function needs both ingredients and instructions.
What we have above are instructions, but we still need to say what our
ingredients are. If we look at the above code, we can see that we need
to define our predictor (<code>food$pork</code>) and outcome (<code>stegen$ill</code>);
everything else flows from that. We can then write our function (which
we will call <code>single_risk_ratio()</code>) like
this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">single_risk_ratio <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(predictor, outcome) { <span style="color:#75715e"># ingredients defined here</span>
  et  <span style="color:#f92672">&lt;-</span> epitable(predictor, outcome) <span style="color:#75715e"># ingredients used here</span>
  rr  <span style="color:#f92672">&lt;-</span> riskratio(et)
  estimate <span style="color:#f92672">&lt;-</span> rr<span style="color:#f92672">$</span>measure[<span style="color:#ae81ff">2</span>, ]
  res <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">data.frame</span>(estimate <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;estimate&#34;</span>],
                    lower    <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;lower&#34;</span>],
                    upper    <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;upper&#34;</span>],
                    p.value  <span style="color:#f92672">=</span> rr<span style="color:#f92672">$</span>p.value[<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;fisher.exact&#34;</span>]
                   )
  <span style="color:#66d9ef">return</span>(res) <span style="color:#75715e"># return the data frame</span>
}</code></pre></div>
<p>Now, we can use this <code>single_risk_ratio()</code> like any other
function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">pork_rr <span style="color:#f92672">&lt;-</span> single_risk_ratio(predictor <span style="color:#f92672">=</span> food<span style="color:#f92672">$</span>pork, outcome <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>ill)
pork_rr
<span style="color:#75715e">##          estimate     lower    upper   p.value</span>
<span style="color:#75715e">## estimate 1.251852 0.9176849 1.707703 0.1708777</span></code></pre></div>
<p>If we change the variable, we’ll get a different
answer:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fruit_rr <span style="color:#f92672">&lt;-</span> single_risk_ratio(predictor <span style="color:#f92672">=</span> food<span style="color:#f92672">$</span>fruit_salad, outcome <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>ill)
fruit_rr
<span style="color:#75715e">##          estimate    lower    upper      p.value</span>
<span style="color:#75715e">## estimate 2.500618 1.886773 3.314171 9.998203e-09</span></code></pre></div>
<p>We can combine the two using a function from <em>dplyr</em> called
<code>bind_rows()</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bind_rows(pork <span style="color:#f92672">=</span> pork_rr, fruit <span style="color:#f92672">=</span> fruit_rr, <span style="color:#ae81ff">.i</span>d <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;predictor&#34;</span>)
<span style="color:#75715e">##   predictor estimate     lower    upper      p.value</span>
<span style="color:#75715e">## 1      pork 1.251852 0.9176849 1.707703 1.708777e-01</span>
<span style="color:#75715e">## 2     fruit 2.500618 1.8867735 3.314171 9.998203e-09</span></code></pre></div>
<p>Here we can see that the fruit salad has a higher risk ratio with a
lower P-value, but we want to compare all of the variables and still,
copying and pasting all this code would be a nightmare and potentially
lead to errors. We will see in the next section how we can use R to
apply the function <code>single_risk_ratio()</code> to each column of our <code>food</code>
data frame to give us a table of risk ratios for all the food items.</p>

<h3 id="multiple-variables">Multiple variables</h3>

<p>In the example above, we have computed the risk ratio using a simple
recipe:</p>

<ol>
<li>create a contingency table</li>
<li>estimate the risk ratio</li>
<li>extract estimate into a data frame</li>
</ol>

<p>We placed this recipe in a function called <code>single_risk_ratio()</code> and we
know we can use it to calcuate the risk ratio for individual variables,
but we need to be able to calculate it over all the variables in our
<code>food</code> data frame. The solution is to use an R function called
<code>lapply()</code>, which takes each element of a list (or column of a data
frame) and uses it as the first ingredient (also known as argument) of a
function. Like <code>tapply()</code>, the function can be anything and additional
arguments are placed behind the function. It will then return the output
as a list:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">all_rr <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">lapply</span>(food, FUN <span style="color:#f92672">=</span> single_risk_ratio, outcome <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>ill)
<span style="color:#66d9ef">head</span>(all_rr)
<span style="color:#75715e">## $tiramisu</span>
<span style="color:#75715e">##          estimate    lower    upper      p.value</span>
<span style="color:#75715e">## estimate 18.31169 8.814202 38.04291 1.794084e-41</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $wmousse</span>
<span style="color:#75715e">##          estimate    lower    upper      p.value</span>
<span style="color:#75715e">## estimate 2.847222 2.128267 3.809049 5.825494e-11</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $dmousse</span>
<span style="color:#75715e">##          estimate    lower    upper      p.value</span>
<span style="color:#75715e">## estimate 4.501021 3.086945 6.562862 1.167009e-19</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $mousse</span>
<span style="color:#75715e">##          estimate    lower    upper      p.value</span>
<span style="color:#75715e">## estimate 4.968958 3.299403 7.483336 1.257341e-20</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $beer</span>
<span style="color:#75715e">##           estimate     lower   upper    p.value</span>
<span style="color:#75715e">## estimate 0.6767842 0.4757688 0.96273 0.02806394</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## $redjelly</span>
<span style="color:#75715e">##          estimate    lower    upper      p.value</span>
<span style="color:#75715e">## estimate  2.08206 1.555917 2.786123 4.415074e-06</span></code></pre></div>
<p>Finally, like we did above, we re-shape these results into a data frame</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">all_food_df <span style="color:#f92672">&lt;-</span> bind_rows(all_rr, <span style="color:#ae81ff">.i</span>d <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;predictor&#34;</span>)
all_food_df
<span style="color:#75715e">##      predictor   estimate     lower     upper      p.value</span>
<span style="color:#75715e">## 1     tiramisu 18.3116883 8.8142022 38.042913 1.794084e-41</span>
<span style="color:#75715e">## 2      wmousse  2.8472222 2.1282671  3.809049 5.825494e-11</span>
<span style="color:#75715e">## 3      dmousse  4.5010211 3.0869446  6.562862 1.167009e-19</span>
<span style="color:#75715e">## 4       mousse  4.9689579 3.2994031  7.483336 1.257341e-20</span>
<span style="color:#75715e">## 5         beer  0.6767842 0.4757688  0.962730 2.806394e-02</span>
<span style="color:#75715e">## 6     redjelly  2.0820602 1.5559166  2.786123 4.415074e-06</span>
<span style="color:#75715e">## 7  fruit_salad  2.5006177 1.8867735  3.314171 9.998203e-09</span>
<span style="color:#75715e">## 8       tomato  1.2898653 0.9379601  1.773799 1.368934e-01</span>
<span style="color:#75715e">## 9        mince  1.0568237 0.7571858  1.475036 7.893882e-01</span>
<span style="color:#75715e">## 10      salmon  1.0334249 0.7452531  1.433026 8.976422e-01</span>
<span style="color:#75715e">## 11 horseradish  1.2557870 0.9008457  1.750578 2.026013e-01</span>
<span style="color:#75715e">## 12  chickenwin  1.1617347 0.8376217  1.611261 4.176598e-01</span>
<span style="color:#75715e">## 13   roastbeef  0.7607985 0.4129094  1.401795 4.172932e-01</span>
<span style="color:#75715e">## 14        pork  1.2518519 0.9176849  1.707703 1.708777e-01</span></code></pre></div>
<p>This is still in the order of our data, but we want it sorted in order
of the risk ratio. For this, we will use the <em>dplyr</em> functions
<code>arrange()</code> and <code>desc()</code> to arrange our data by the risk ratio estimate
in descending order:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">all_food_df <span style="color:#f92672">&lt;-</span> arrange(all_food_df, desc(estimate))
all_food_df
<span style="color:#75715e">##      predictor   estimate     lower     upper      p.value</span>
<span style="color:#75715e">## 1     tiramisu 18.3116883 8.8142022 38.042913 1.794084e-41</span>
<span style="color:#75715e">## 2       mousse  4.9689579 3.2994031  7.483336 1.257341e-20</span>
<span style="color:#75715e">## 3      dmousse  4.5010211 3.0869446  6.562862 1.167009e-19</span>
<span style="color:#75715e">## 4      wmousse  2.8472222 2.1282671  3.809049 5.825494e-11</span>
<span style="color:#75715e">## 5  fruit_salad  2.5006177 1.8867735  3.314171 9.998203e-09</span>
<span style="color:#75715e">## 6     redjelly  2.0820602 1.5559166  2.786123 4.415074e-06</span>
<span style="color:#75715e">## 7       tomato  1.2898653 0.9379601  1.773799 1.368934e-01</span>
<span style="color:#75715e">## 8  horseradish  1.2557870 0.9008457  1.750578 2.026013e-01</span>
<span style="color:#75715e">## 9         pork  1.2518519 0.9176849  1.707703 1.708777e-01</span>
<span style="color:#75715e">## 10  chickenwin  1.1617347 0.8376217  1.611261 4.176598e-01</span>
<span style="color:#75715e">## 11       mince  1.0568237 0.7571858  1.475036 7.893882e-01</span>
<span style="color:#75715e">## 12      salmon  1.0334249 0.7452531  1.433026 8.976422e-01</span>
<span style="color:#75715e">## 13   roastbeef  0.7607985 0.4129094  1.401795 4.172932e-01</span>
<span style="color:#75715e">## 14        beer  0.6767842 0.4757688  0.962730 2.806394e-02</span></code></pre></div>
<p>Now we can use this data frame to plot the results using <em>ggplot2</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># first, make sure the predictors are factored in the right order</span>
all_food_df<span style="color:#f92672">$</span>predictor <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">factor</span>(all_food_df<span style="color:#f92672">$</span>predictor, <span style="color:#66d9ef">unique</span>(all_food_df<span style="color:#f92672">$</span>predictor))
<span style="color:#75715e"># plot</span>
p <span style="color:#f92672">&lt;-</span> ggplot(all_food_df, aes(x <span style="color:#f92672">=</span> estimate, y <span style="color:#f92672">=</span> predictor, color <span style="color:#f92672">=</span> p.value)) <span style="color:#f92672">+</span>
  geom_point() <span style="color:#f92672">+</span>
  geom_errorbarh(aes(xmin <span style="color:#f92672">=</span> lower, xmax <span style="color:#f92672">=</span> upper)) <span style="color:#f92672">+</span>
  geom_vline(xintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> 
  scale_x_log10() <span style="color:#f92672">+</span> 
  scale_color_viridis_c(trans <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;log10&#34;</span>) <span style="color:#f92672">+</span> 
  labs(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Risk Ratio (log scale)&#34;</span>, 
       y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Predictor&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Risk Ratio for gastroenteritis in Stegen, Germany&#34;</span>)
p</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/plot-arrange-1.png" alt="" /><!-- --></p>

<p>The results are a lot clearer now: the tiramisu has by far the highest
risk ratio in this outbreak, but it’s wide confidence interval suggests
that there may be confounding factors involved (i.e. the food items were
not independent or in this case, were potentially sharing contaminated
ingredients).</p>

<p><details></p>

<p><summary> <b>Going Further:</b> Creating a function for multiple risk
ratios </summary></p>

<p>Just like we created the function <code>single_risk_ratio()</code> to calculate the
risk ratio of a single variable, we can create another function that
will calculate the risk ratio for all variables in a data frame. We can
do it the same way we did above. First, define the recipe:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">all_rr <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">lapply</span>(food, FUN <span style="color:#f92672">=</span> single_risk_ratio, outcome <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>ill)
all_food_df <span style="color:#f92672">&lt;-</span> bind_rows(all_rr, <span style="color:#ae81ff">.i</span>d <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;predictor&#34;</span>)
all_food_df <span style="color:#f92672">&lt;-</span> arrange(all_food_df, desc(estimate))
all_food_df<span style="color:#f92672">$</span>predictor <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">factor</span>(all_food_df<span style="color:#f92672">$</span>predictor, <span style="color:#66d9ef">unique</span>(all_food_df<span style="color:#f92672">$</span>predictor))</code></pre></div>
<p>Now, find the ingredients. The first step is <code>lapply()</code> which needs
<code>food</code> and <code>stegen$ill</code>, which are a data frame of predictors and a
vector of outcomes, resepectively, so we will add these as <em>arguments</em>
called <code>predictors</code> and <code>outcome</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">multi_risk_ratio <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(predictors, outcome) {
  all_rr <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">lapply</span>(predictors, FUN <span style="color:#f92672">=</span> single_risk_ratio, outcome <span style="color:#f92672">=</span> outcome)
  all_food_df <span style="color:#f92672">&lt;-</span> bind_rows(all_rr, <span style="color:#ae81ff">.i</span>d <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;predictor&#34;</span>)
  all_food_df <span style="color:#f92672">&lt;-</span> arrange(all_food_df, desc(estimate))
  all_food_df<span style="color:#f92672">$</span>predictor <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">factor</span>(all_food_df<span style="color:#f92672">$</span>predictor, <span style="color:#66d9ef">unique</span>(all_food_df<span style="color:#f92672">$</span>predictor))
  <span style="color:#66d9ef">return</span>(all_food_df)
}</code></pre></div>
<p>And we can call the function like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">multi_risk_ratio(predictors <span style="color:#f92672">=</span> food, outcome <span style="color:#f92672">=</span> stegen<span style="color:#f92672">$</span>ill)
<span style="color:#75715e">##      predictor   estimate     lower     upper      p.value</span>
<span style="color:#75715e">## 1     tiramisu 18.3116883 8.8142022 38.042913 1.794084e-41</span>
<span style="color:#75715e">## 2       mousse  4.9689579 3.2994031  7.483336 1.257341e-20</span>
<span style="color:#75715e">## 3      dmousse  4.5010211 3.0869446  6.562862 1.167009e-19</span>
<span style="color:#75715e">## 4      wmousse  2.8472222 2.1282671  3.809049 5.825494e-11</span>
<span style="color:#75715e">## 5  fruit_salad  2.5006177 1.8867735  3.314171 9.998203e-09</span>
<span style="color:#75715e">## 6     redjelly  2.0820602 1.5559166  2.786123 4.415074e-06</span>
<span style="color:#75715e">## 7       tomato  1.2898653 0.9379601  1.773799 1.368934e-01</span>
<span style="color:#75715e">## 8  horseradish  1.2557870 0.9008457  1.750578 2.026013e-01</span>
<span style="color:#75715e">## 9         pork  1.2518519 0.9176849  1.707703 1.708777e-01</span>
<span style="color:#75715e">## 10  chickenwin  1.1617347 0.8376217  1.611261 4.176598e-01</span>
<span style="color:#75715e">## 11       mince  1.0568237 0.7571858  1.475036 7.893882e-01</span>
<span style="color:#75715e">## 12      salmon  1.0334249 0.7452531  1.433026 8.976422e-01</span>
<span style="color:#75715e">## 13   roastbeef  0.7607985 0.4129094  1.401795 4.172932e-01</span>
<span style="color:#75715e">## 14        beer  0.6767842 0.4757688  0.962730 2.806394e-02</span></code></pre></div>
<p>Note that we have defined arguments for <code>predictors</code> and <code>outcome</code>, but
we didn’t define an argument for the <code>single_risk_ratio()</code> function.
This is because we know that we’ve defined it above, but this also means
that if we want to use the <code>multi_risk_ratio()</code> function in other
scripts, we have to also define <code>single_risk_ratio()</code> as well. One way
of keeping these organised is to always write the functions
together:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">single_risk_ratio <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(predictor, outcome) { <span style="color:#75715e"># ingredients defined here</span>
  et  <span style="color:#f92672">&lt;-</span> epitools<span style="color:#f92672">::</span>epitable(predictor, outcome) <span style="color:#75715e"># ingredients used here</span>
  rr  <span style="color:#f92672">&lt;-</span> epitools<span style="color:#f92672">::</span>riskratio(et)
  estimate <span style="color:#f92672">&lt;-</span> rr<span style="color:#f92672">$</span>measure[<span style="color:#ae81ff">2</span>, ]
  res <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">data.frame</span>(estimate <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;estimate&#34;</span>],
                    lower    <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;lower&#34;</span>],
                    upper    <span style="color:#f92672">=</span> estimate[<span style="color:#e6db74">&#34;upper&#34;</span>],
                    p.value  <span style="color:#f92672">=</span> rr<span style="color:#f92672">$</span>p.value[<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;fisher.exact&#34;</span>]
                   )
  <span style="color:#66d9ef">return</span>(res) <span style="color:#75715e"># return the data frame</span>
}

multi_risk_ratio <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">function</span>(predictors, outcome) {
  all_rr <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">lapply</span>(predictors, FUN <span style="color:#f92672">=</span> single_risk_ratio, outcome <span style="color:#f92672">=</span> outcome)
  all_food_df <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span>bind_rows(all_rr, <span style="color:#ae81ff">.i</span>d <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;predictor&#34;</span>)
  all_food_df <span style="color:#f92672">&lt;-</span> dplyr<span style="color:#f92672">::</span>arrange(all_food_df, dplyr<span style="color:#f92672">::</span>desc(estimate))
  all_food_df<span style="color:#f92672">$</span>predictor <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">factor</span>(all_food_df<span style="color:#f92672">$</span>predictor, <span style="color:#66d9ef">unique</span>(all_food_df<span style="color:#f92672">$</span>predictor))
  <span style="color:#66d9ef">return</span>(all_food_df)
}</code></pre></div>
<p>You might notice, however that these functions look a bit different. The
<code>epitable()</code> function is now written as <code>epitools::epitable()</code>. This is
no accident. This is a way for us to tell R to use a function <em>even if
the package hasn’t been loaded</em>, which makes it easier to share these
functions.</p>

<p></details></p>

<h1 id="plotting-a-very-basic-spatial-overview-of-cases">Plotting a very basic spatial overview of cases</h1>

<p>To complete your report, you would like to include a very basic spatial
overview of cases. Based on the postal codes of all individuals with a
date of symptom onset spatial coordinates were generated providing
everyone with a latitude and longitude which corresponds with their
household (in relation to their postal code). The variables <code>latitude</code>
and <code>longitude</code> include the longitude and latitude which we will use to
plot the cases using <em>ggplot2</em>. Here, we want to plot the data to see if
there is any spatial component to the outbreak. Since we have the
coordinates for each household, it becomes straightforward to plot them
with <em>ggplot2</em>. Here we will use points and color them based on whether
or not the person was ill:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">ggplot(stegen) <span style="color:#f92672">+</span>
  geom_point(aes(x <span style="color:#f92672">=</span> longitude, y <span style="color:#f92672">=</span> latitude, color <span style="color:#f92672">=</span> ill)) <span style="color:#f92672">+</span>
  scale_color_manual(<span style="color:#e6db74">&#34;Illness&#34;</span>, values <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#e6db74">&#34;non case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#66cc99&#34;</span>, <span style="color:#e6db74">&#34;case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#993333&#34;</span>)) <span style="color:#f92672">+</span>
  coord_map()</code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/stegen-ill-plot-1-1.png" alt="" /><!-- --></p>

<p>Here, we can see that there is no clear correlation between illness and
location.</p>

<h2 id="using-shapefile-data">Using shapefile data</h2>

<p>It’s not uncommon to have community-level shapefile data. These data
give us a better idea of how the cases relate to each other. In this
instance, we have shapefiles of the households located in
<code>data/stegen-map/stegen_households.shp</code>. We will use the <code>read_sf()</code>
function from the <em>sf</em> package to read the shapefiles
in:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen_shp <span style="color:#f92672">&lt;-</span> read_sf(here(<span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;stegen-map&#34;</span>, <span style="color:#e6db74">&#34;stegen_households.shp&#34;</span>))</code></pre></div>
<p>Now we can use the same ggplot2 code as above, but we place a call to
<code>geom_sf()</code> right after the ggplot call to place the shapes underneath
the points. Note that we are removing the <code>coord_map()</code> because the
shapefile ensures that the projection is correct.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">ggplot(stegen) <span style="color:#f92672">+</span>
  geom_sf(data <span style="color:#f92672">=</span> stegen_shp) <span style="color:#f92672">+</span>
  geom_point(aes(x <span style="color:#f92672">=</span> longitude, y <span style="color:#f92672">=</span> latitude, color <span style="color:#f92672">=</span> ill)) <span style="color:#f92672">+</span> 
  scale_color_manual(<span style="color:#e6db74">&#34;Illness&#34;</span>, values <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>(<span style="color:#e6db74">&#34;non case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#66cc99&#34;</span>, <span style="color:#e6db74">&#34;case&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#993333&#34;</span>)) </code></pre></div>
<p><img src="practical-stegen_files/figure-gfm/sf_map-1.png" alt="" /><!-- --></p>

<h2 id="interactive-maps">Interactive maps</h2>

<p>It is also possible to create interactive maps that allow you to zoom in
and get information about individual cases. This uses a different system
than <em>ggplot2</em>, but behaves in a similar idea of building up the map
layer by layer. Here, we use the package <em>leaflet</em>, which uses image
data from open street maps. Because mapping could take up an entire
workshop in and of itself, we will present the code as is. One thing
that we must do first is to subset the data to all cases with
non-missing coordinates with the command <code>!is.na()</code> where the <code>!</code> means
“not” and <code>is.na()</code> checks each element of a vector if it’s missing.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stegen_sub <span style="color:#f92672">&lt;-</span> stegen[<span style="color:#f92672">!</span><span style="color:#66d9ef">is.na</span>(stegen<span style="color:#f92672">$</span>longitude), ]</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># create the map</span>
lmap <span style="color:#f92672">&lt;-</span> leaflet()
<span style="color:#75715e"># add open street map tiles</span>
lmap <span style="color:#f92672">&lt;-</span> addTiles(lmap)
<span style="color:#75715e"># set the coordinates for Stegen</span>
lmap <span style="color:#f92672">&lt;-</span> setView(lmap, lng <span style="color:#f92672">=</span> <span style="color:#ae81ff">7.963</span>, lat <span style="color:#f92672">=</span> <span style="color:#ae81ff">47.982</span>, zoom <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>)
<span style="color:#75715e"># Add the shapefile</span>
lmap <span style="color:#f92672">&lt;-</span> addPolygons(lmap, data <span style="color:#f92672">=</span> st_transform(stegen_shp, <span style="color:#e6db74">&#39;+proj=longlat +ellps=GRS80&#39;</span>))
<span style="color:#75715e"># Add the cases</span>
lmap <span style="color:#f92672">&lt;-</span> addCircleMarkers(lmap, 
                         label <span style="color:#f92672">=</span> <span style="color:#f92672">~</span>ill, 
                         color <span style="color:#f92672">=</span> <span style="color:#f92672">~</span><span style="color:#66d9ef">ifelse</span>(ill <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;case&#34;</span>, <span style="color:#e6db74">&#34;#993333&#34;</span>, <span style="color:#e6db74">&#34;#66cc99&#34;</span>), 
                         stroke <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>,
                         fillOpacity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.8</span>,
                         data <span style="color:#f92672">=</span> stegen_sub)
<span style="color:#75715e"># show the map</span>
lmap</code></pre></div>
<!--html_preserve-->

<iframe src="widgets/stegen-casemap.html" width="100%" height="500">

</iframe>

<!--html_preserve-->

<h1 id="conclusion">Conclusion</h1>

<p>This case study illustrated how <strong>R</strong> can be used to import data, clean
data, and derive basic summaries for a first glance at the data. It also
showed how to generate graphics using <em>ggplot2</em>, and how to detect
associations between several potential risk factors and the occurrence
of illness. One major caveat here is that we are not accounting for
potential confounding factors. These will be treated in a separate case
study, which will focus on the use of logistic regression in epidemic
studies. Lastly we plotted a basic overview of the cases in this
outbreak in relative distance to each other. More sophisticated mapping
and spatial methodologies will be covered in other case studies.</p>

<hr />

<h1 id="about-this-document">About this document</h1>

<h2 id="source">Source</h2>

<p>This case study was first designed by Alain Moren and Gilles Desve,
EPIET. It is based on an real outbreak investigation conducted by Anja
Hauri, RKI, Berlin, 1998.</p>

<h2 id="contributors">Contributors</h2>

<ul>
<li><p>original version: Alain Moren, Gilles Desve</p></li>

<li><p>reviewers, previous versions: Marta Valenciano, Alain Moren</p></li>

<li><p>adaptation for EPIET module: Alicia Barrasa, Ioannis Karagiannis</p></li>

<li><p>rewriting for R: Alexander Spina, Patrick Keating, Janetta Skarp,
Zhian N. Kamvar, Thibaut Jombart, Amrish Baidjoe</p></li>
</ul>

<p>Contributions are welcome via <a href="https://github.com/reconhub/learn/pulls">pull
requests</a>. The <a href="https://github.com/reconhub/learn/blob/master/content/post/practical-stegen.Rmd">source file for
this case study can be found
here</a>.</p>

<h2 id="legal-stuff">Legal stuff</h2>

<p><strong>License</strong>: <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>
<strong>Copyright</strong>: 2018</p>

<hr />
    
                </div>
            </section>
        
            <footer class="post-full-footer">
              <section class="author-card">
                <img class="author-profile-image" src="https://reconlearn.org/img/user.png" alt="Author" />
                <section class="author-card-content">
                        <span class="post-card-author">
                                <a href="/authors/amrish-baidjoe.html">Amrish Baidjoe</a><br><a href="/authors/thibaut-jombart.html">Thibaut Jombart</a><br><a href="/authors/janetta-skarp.html">Janetta Skarp</a><br><a href="/authors/zhian-n.-kamvar.html">Zhian N. Kamvar</a><br><a href="/authors/alexander-spina.html">Alexander Spina</a><br><a href="/authors/patrick-keating.html">Patrick Keating</a><br>
                              </span>
                </section>
              </section>
            </footer>
        </article>
    
    
    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "https:\/\/reconlearn.org\/post\/stegen.html";  
this.page.identifier = "https:\/\/reconlearn.org\/post\/stegen.html"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://reconlearn.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      
<article class="read-next-card" style="background-color: #090a0b;">
    <header class="read-next-card-header">
        <small class="read-next-card-header-sitetitle">&mdash; RECON learn &mdash;</small>
        
        <h3 class="read-next-card-header-title"><a href="https://reconlearn.org/tags/level-beginner/">#level: beginner</a></h3>
    </header>
    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
    </div>

    <div class="read-next-card-content">
      
        <ul>
          <li><a href="https://reconlearn.org/post/compartmentalebola.html">Compartmental model, example for Ebola</a></li>            
        
          <li><a href="https://reconlearn.org/post/basicvbdmodelling.html">Basic Concepts on Vector Borne Disease Modelling</a></li>            
        
          <li><a href="https://reconlearn.org/post/practical-compartmental-ebola.html">Ebola: building few models for Ebola</a></li>            
        
          <li><a href="https://reconlearn.org/post/reproducibility.html">Reproducibility using R</a></li>            
        </ul>
    </div>
    <footer class="read-next-card-footer">
      
        <a href="https://reconlearn.org/tags/level-beginner/">See all related posts →</a>
    </footer>
</article>


      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://reconlearn.org/post/bag_of_slides.html">
      <div class="post-card-image" style="background-image: url(https://reconlearn.org/img/highres/suitcase.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://reconlearn.org/post/bag_of_slides.html">
          <header class="post-card-header">
              
              <h2 class="post-card-title">A bag of slides</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>Collection of miscellaneous slides This is a collection of short slide decks on various topics, too short to form a lecture, but useful every now and then.
Why use R Click on the image below to access the slides:



Importing data into R Click on the image below to access the slides:



Graphics using ggplot2 Click on the image below to access the slides: ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://reconlearn.org/img/user.png" alt="Author" />
          <span class="post-card-author"><a href="/">Thibaut Jombart</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://reconlearn.org/post/reproducibility.html">
      <div class="post-card-image" style="background-image: url(https://reconlearn.org/img/highres/printing-press.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://reconlearn.org/post/reproducibility.html">
          <header class="post-card-header">
              
              <h2 class="post-card-title">Reproducibility using R</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>Beyond the availability of data and methods, reproducible science requires the traceability of analyses. Whether it is for yourself or for collaborators, as series of tools and good practices can facilitate your work flow, simplify analyses, and prevent the loss of data and results. This lecture provides an introduction to reproducibility using R.
Slides Click on the image below to access the slides:
  
Related packages knitr knitr provides excellent resources for literate programming mixing R with LaTeX or markdown. ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://reconlearn.org/img/user.png" alt="Author" />
          <span class="post-card-author"><a href="/">Thibaut Jombart</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://reconlearn.org/">
      <img src="https://reconlearn.org/img/logo/learnBlueAndWhite.png" alt="" />
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">An outbreak of gastroenteritis in Stegen, Germany, June 1998</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>
    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=An%20outbreak%20of%20gastroenteritis%20in%20Stegen%2c%20Germany%2c%20June%201998&amp;url=https%3a%2f%2freconlearn.org%2fpost%2fstegen.html"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2freconlearn.org%2fpost%2fstegen.html"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">RECON</a> ©2018 RECON <br>
      <span style="font-size: 0.8em; color: #555;">Hugo port of <a href="https://github.com/TryGhost/Casper">Casper 2.1.7</a> by <a href="https://www.telematika.org">EM</a></span>
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        <a href="https://twitter.com/teebzr" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/reconhub/learn" target="_blank" rel="noopener">Github</a>
        
        
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://reconlearn.org/js/jquery.fitvids.js"></script>

<script>hljs.initHighlightingOnLoad();</script>



    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
